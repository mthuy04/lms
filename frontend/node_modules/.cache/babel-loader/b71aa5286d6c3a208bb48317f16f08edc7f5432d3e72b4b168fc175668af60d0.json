{"ast":null,"code":"var _jsxFileName = \"/Users/admin/Downloads/library-ms/frontend/src/App.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$(),\n  _s5 = $RefreshSig$(),\n  _s6 = $RefreshSig$(),\n  _s7 = $RefreshSig$(),\n  _s8 = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport axios from 'axios';\nimport { LogIn, User, BookOpen, Settings, Home, Plus, Trash2, RotateCcw, Save } from 'lucide-react';\n\n// Configure Axios to point to the Flask backend\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = 'http://localhost:5001/api'; // Đảm bảo port này khớp với backend Flask\naxios.defaults.baseURL = API_BASE_URL;\naxios.defaults.headers.common['Content-Type'] = 'application/json';\n\n// --- Global Setup for Tailwind CDN ---\n(function () {\n  if (!document.getElementById('tailwind-cdn')) {\n    const script = document.createElement('script');\n    script.src = 'https://cdn.tailwindcss.com';\n    script.id = 'tailwind-cdn';\n    document.head.appendChild(script);\n  }\n})();\n\n// --- Utility Functions and Hooks ---\n\n// Hook để quản lý trạng thái global của ứng dụng\nconst useAppState = () => {\n  _s();\n  // State cho user, khởi tạo từ localStorage\n  const [user, setUser] = useState(() => {\n    try {\n      const savedUser = localStorage.getItem('user_data');\n      // Xử lý lỗi parse JSON nếu dữ liệu trong localStorage bị hỏng\n      return savedUser && savedUser !== 'undefined' && savedUser !== 'null' ? JSON.parse(savedUser) : null;\n    } catch (e) {\n      console.error(\"Lỗi parse user_data từ localStorage\", e);\n      localStorage.removeItem('user_data'); // Xóa dữ liệu lỗi\n      return null;\n    }\n  });\n  // State cho token, khởi tạo từ localStorage\n  const [token, setToken] = useState(() => {\n    const storedToken = localStorage.getItem('jwt_token');\n    // Đảm bảo token không phải là null hoặc chuỗi \"null\"/\"undefined\"\n    return storedToken && storedToken !== 'null' && storedToken !== 'undefined' ? storedToken : null;\n  });\n  // State cho route hiện tại\n  const [route, setRoute] = useState('home');\n  // State cho thông báo (notification)\n  const [message, setMessage] = useState({\n    text: '',\n    type: ''\n  });\n  // State cho trạng thái loading\n  const [loading, setLoading] = useState(false);\n\n  // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n  // Header sẽ được thêm thủ công vào từng request cần xác thực.\n\n  // Lưu user data vào localStorage mỗi khi state 'user' thay đổi\n  useEffect(() => {\n    if (user) {\n      localStorage.setItem('user_data', JSON.stringify(user));\n    } else {\n      // Nếu user là null (ví dụ sau khi logout), xóa khỏi storage\n      localStorage.removeItem('user_data');\n    }\n  }, [user]);\n\n  // Hàm hiển thị thông báo\n  const notify = useCallback((text, type = 'success') => {\n    setMessage({\n      text,\n      type\n    });\n    setTimeout(() => setMessage({\n      text: '',\n      type: ''\n    }), 4000);\n  }, []); // setMessage là stable, không cần đưa vào dependency\n\n  // Hàm xử lý đăng nhập\n  const login = useCallback((userData, jwtToken) => {\n    console.log('Login với:', {\n      userData,\n      jwtToken\n    });\n    localStorage.setItem('jwt_token', jwtToken);\n    localStorage.setItem('user_data', JSON.stringify(userData));\n    setToken(jwtToken);\n    setUser(userData);\n    // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n    // Chuyển hướng sau khi đăng nhập (ví dụ: về trang sách nếu là user, về admin dashboard nếu là admin)\n    setRoute(userData.role === 'admin' ? 'dashboard' : 'books');\n  }, []); // setToken, setUser, setRoute là stable\n\n  // Hàm xử lý đăng xuất\n  const logout = useCallback(() => {\n    localStorage.removeItem('jwt_token');\n    localStorage.removeItem('user_data');\n    // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n    setToken(null);\n    setUser(null);\n    setRoute('home'); // Chuyển về trang chủ sau khi logout\n  }, []); // setToken, setUser, setRoute là stable\n\n  // Hàm lấy thông tin profile user\n  const fetchProfile = useCallback(async authToken => {\n    // Nhận token làm đối số\n    if (!authToken) {\n      console.log(\"fetchProfile: Không có token.\");\n      // Không cần setLoading(true) nếu không có token\n      return;\n    }\n    setLoading(true);\n    try {\n      // Thêm header Authorization thủ công\n      const res = await axios.get('/profile', {\n        headers: {\n          'Authorization': `Bearer ${authToken}`\n        }\n      });\n      // Giả sử backend trả về trực tiếp data user (không có key 'user' bên ngoài)\n      const newUserData = res.data;\n\n      // Dùng functional update để cập nhật state an toàn\n      setUser(prevUser => ({\n        ...prevUser,\n        // Giữ lại các thuộc tính cũ (nếu có)\n        ...newUserData // Ghi đè bằng dữ liệu mới từ API\n      }));\n      // Để useEffect tự động lưu vào localStorage khi 'user' thay đổi\n    } catch (error) {\n      var _error$response;\n      console.error('Lỗi fetch profile:', ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n      // Tự động logout nếu token không hợp lệ (401) hoặc lỗi xác thực (422)\n      if (error.response && (error.response.status === 401 || error.response.status === 422)) {\n        notify('Phiên làm việc không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại.', 'error');\n        logout(); // Gọi hàm logout đã định nghĩa\n      } else {\n        notify('Không thể tải dữ liệu hồ sơ.', 'error');\n      }\n    } finally {\n      setLoading(false);\n    }\n    // Chỉ phụ thuộc vào các hàm stable (logout, notify)\n  }, [logout, notify]);\n\n  // Các biến tiện ích để kiểm tra vai trò user\n  const isAdmin = useMemo(() => (user === null || user === void 0 ? void 0 : user.role) === 'admin', [user]);\n  const isLibrarian = useMemo(() => (user === null || user === void 0 ? void 0 : user.role) === 'librarian', [user]); // Thêm nếu có vai trò librarian\n  const isLibrarianOrAdmin = useMemo(() => isAdmin || isLibrarian, [isAdmin, isLibrarian]);\n\n  // Trả về các state và hàm cần thiết cho các component con\n  return {\n    user,\n    token,\n    route,\n    setRoute,\n    login,\n    logout,\n    message,\n    loading,\n    setLoading,\n    notify,\n    fetchProfile,\n    isAdmin,\n    isLibrarianOrAdmin // Thêm isLibrarianOrAdmin nếu cần\n  };\n};\n\n// --- Các Component Chung ---\n\n// Component hiển thị thông báo\n_s(useAppState, \"OEZt+fV478xR1Li1+50a6tEJFzg=\");\nconst Notification = ({\n  message\n}) => {\n  if (!message.text) return null;\n  // Đổi màu thông báo thành công sang xanh ngọc\n  const classes = message.type === 'success' ? 'bg-emerald-500 border-emerald-700' : 'bg-red-500 border-red-700';\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-semibold shadow-xl transition-all duration-300 ${classes}`,\n    children: message.text\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n};\n\n// Component Header\n_c = Notification;\nconst Header = ({\n  user,\n  setRoute,\n  logout\n}) => {\n  return (\n    /*#__PURE__*/\n    // Đổi màu nền header sang xám đá\n    _jsxDEV(\"header\", {\n      className: \"bg-stone-900 shadow-xl text-white sticky top-0 z-40\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container mx-auto px-4 py-4 flex justify-between items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-4 cursor-pointer\",\n          onClick: () => setRoute('home'),\n          children: [/*#__PURE__*/_jsxDEV(BookOpen, {\n            className: \"h-7 w-7 text-rose-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-2xl font-bold text-rose-100\",\n            children: \"LMS Pro\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"nav\", {\n          className: \"flex items-center space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(NavItem, {\n            icon: Home,\n            label: \"Home\",\n            onClick: () => setRoute('home')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 11\n          }, this), user ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(NavItem, {\n              icon: BookOpen,\n              label: \"Books\",\n              onClick: () => setRoute('books')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(NavItem, {\n              icon: User,\n              label: \"Profile\",\n              onClick: () => setRoute('profile')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: logout,\n              className: \"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\",\n              children: [/*#__PURE__*/_jsxDEV(LogIn, {\n                className: \"h-5 w-5 rotate-180\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 193,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"Logout (\", user.username || 'User', \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(NavItem, {\n              icon: LogIn,\n              label: \"Login\",\n              onClick: () => setRoute('login')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(NavItem, {\n              icon: User,\n              label: \"Register\",\n              onClick: () => setRoute('register')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n// Component cho một mục trong Navigation\n_c2 = Header;\nconst NavItem = ({\n  icon: Icon,\n  label,\n  onClick\n}) => /*#__PURE__*/_jsxDEV(\"button\", {\n  onClick: onClick\n  // Đổi màu chữ sang xám đá, hover nền xám đá\n  ,\n  className: \"flex items-center space-x-2 px-3 py-2 rounded-lg text-stone-300 hover:bg-stone-800 hover:text-white transition-colors\",\n  children: [/*#__PURE__*/_jsxDEV(Icon, {\n    className: \"h-5 w-5\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 217,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n    children: label\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 218,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 212,\n  columnNumber: 3\n}, this);\n\n// Component Card chung\n_c3 = NavItem;\nconst Card = ({\n  title,\n  children,\n  className = ''\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: `bg-white p-6 rounded-xl shadow-2xl transition-all duration-300 ${className}`,\n  children: [title && /*#__PURE__*/_jsxDEV(\"h2\", {\n    className: \"text-2xl font-bold text-stone-800 mb-4 border-b pb-2\",\n    children: title\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 226,\n    columnNumber: 15\n  }, this), children]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 224,\n  columnNumber: 3\n}, this);\n\n// Component InputField chung\n_c4 = Card;\nconst InputField = ({\n  label,\n  id,\n  type = 'text',\n  value,\n  onChange,\n  placeholder,\n  required = false,\n  name\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"mb-4\",\n  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n    htmlFor: id,\n    className: \"block text-sm font-medium text-stone-700 mb-1\",\n    children: label\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 235,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n    type: type,\n    id: id,\n    name: name || id\n    // Đảm bảo value không bao giờ là null/undefined để tránh lỗi controlled/uncontrolled\n    ,\n    value: value || '',\n    onChange: onChange,\n    placeholder: placeholder,\n    required: required\n    // Đổi màu focus sang hồng\n    ,\n    className: \"w-full p-3 border border-gray-300 rounded-lg focus:ring-rose-500 focus:border-rose-500 shadow-sm transition duration-150\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 238,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 233,\n  columnNumber: 3\n}, this);\n\n// --- Các Component Xác thực ---\n\n// Component Form chung cho Login/Register\n_c5 = InputField;\nconst AuthForm = ({\n  title,\n  route,\n  state,\n  setState,\n  appState\n}) => {\n  _s2();\n  const isLogin = route === 'login';\n  // Chỉ lấy các hàm/state cần thiết từ appState\n  const {\n    login,\n    notify,\n    setLoading,\n    loading,\n    setRoute\n  } = appState;\n  const [error, setError] = useState(''); // State lỗi cục bộ cho form\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    setLoading(true); // Bắt đầu loading\n    setError(''); // Xóa lỗi cũ\n\n    try {\n      // Chuẩn bị payload dựa trên route (login hay register)\n      const payload = isLogin ? {\n        email: state.identifier,\n        // Login dùng email\n        password: state.password\n      } : {\n        username: state.username,\n        email: state.email,\n        password: state.password,\n        role: 'user' // Vai trò mặc định khi đăng ký\n      };\n      // Gọi API tương ứng\n      const response = await axios.post(isLogin ? '/login' : '/register', payload);\n      console.log('Phản hồi server:', response.data);\n      if (isLogin) {\n        // Xử lý login thành công\n        if (response.data.token && response.data.user) {\n          // Gọi hàm login từ appState để cập nhật state global và localStorage\n          login(response.data.user, response.data.token);\n          notify('Đăng nhập thành công!', 'success');\n          // Không cần setRoute ở đây, hàm login đã xử lý\n        } else {\n          // Ném lỗi nếu response thiếu token hoặc user data\n          throw new Error('Phản hồi không hợp lệ từ server khi đăng nhập');\n        }\n      } else {\n        // Xử lý register thành công\n        notify('Đăng ký thành công! Vui lòng đăng nhập.', 'success');\n        setRoute('login'); // Chuyển hướng sang trang login sau khi đăng ký\n      }\n    } catch (err) {\n      var _err$response, _err$response2, _err$response2$data;\n      // Đổi tên biến lỗi thành err\n      console.error('Lỗi xác thực:', ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err.message);\n      // Lấy thông báo lỗi từ server hoặc lỗi mặc định\n      const message = ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.msg) || err.message || 'Xác thực thất bại.';\n      setError(message); // Cập nhật state lỗi cục bộ\n      notify(message, 'error'); // Hiển thị thông báo lỗi global\n    } finally {\n      setLoading(false); // Kết thúc loading dù thành công hay thất bại\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: title,\n    className: \"max-w-md mx-auto my-12\",\n    children: [/*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: onSubmit,\n      children: [error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 11\n      }, this), !isLogin && /*#__PURE__*/_jsxDEV(InputField, {\n        label: \"Username\",\n        id: \"username\",\n        value: state.username,\n        onChange: e => setState({\n          ...state,\n          username: e.target.value\n        }),\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(InputField, {\n        label: \"Email\",\n        id: isLogin ? \"identifier\" : \"email\" // ID khác nhau cho login/register\n        ,\n        type: \"email\" // Luôn là type email\n        ,\n        value: isLogin ? state.identifier : state.email,\n        onChange: e => setState({\n          ...state,\n          [isLogin ? 'identifier' : 'email']: e.target.value\n        }),\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InputField, {\n        label: \"Password\",\n        id: \"password\",\n        type: \"password\",\n        value: state.password,\n        onChange: e => setState({\n          ...state,\n          password: e.target.value\n        }),\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: loading // Disable khi đang loading\n        // Đổi màu nút sang hồng\n        ,\n        className: \"w-full bg-rose-600 text-white p-3 rounded-lg font-semibold hover:bg-rose-700 transition duration-200 shadow-md disabled:bg-rose-400\",\n        children: loading ? 'Đang xử lý...' : title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-4 text-center text-sm text-stone-500\",\n      children: [isLogin ? \"Chưa có tài khoản? \" : \"Đã có tài khoản? \", /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setRoute(isLogin ? 'register' : 'login'),\n        className: \"text-rose-600 hover:text-rose-800 font-medium\",\n        children: isLogin ? 'Đăng ký tại đây' : 'Đăng nhập tại đây'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 311,\n    columnNumber: 5\n  }, this);\n};\n\n// Component trang Register\n_s2(AuthForm, \"/PuDV6TKqxF+sNNiHmyv2C3jNxE=\");\n_c6 = AuthForm;\nconst RegisterPage = ({\n  appState\n}) => {\n  _s3();\n  const [form, setForm] = useState({\n    username: '',\n    email: '',\n    password: ''\n  });\n  return /*#__PURE__*/_jsxDEV(AuthForm, {\n    title: \"T\\u1EA1o t\\xE0i kho\\u1EA3n\",\n    route: \"register\",\n    state: form,\n    setState: setForm,\n    appState: appState\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 371,\n    columnNumber: 10\n  }, this);\n};\n\n// Component trang Login\n_s3(RegisterPage, \"oI31dXXzZNSfnF2TCW7A3h3P2UE=\");\n_c7 = RegisterPage;\nconst LoginPage = ({\n  appState\n}) => {\n  _s4();\n  const [form, setForm] = useState({\n    identifier: '',\n    password: ''\n  });\n  return /*#__PURE__*/_jsxDEV(AuthForm, {\n    title: \"\\u0110\\u0103ng nh\\u1EADp\",\n    route: \"login\",\n    state: form,\n    setState: setForm,\n    appState: appState\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 377,\n    columnNumber: 10\n  }, this);\n};\n\n// --- Component Trang Profile ---\n_s4(LoginPage, \"FUE98eoixzCyYWqhrEwaLlcEc/w=\");\n_c8 = LoginPage;\nconst ProfilePage = ({\n  appState\n}) => {\n  _s5();\n  var _user$role;\n  // Lấy token trực tiếp để dùng trong các API call của component này\n  const {\n    user,\n    notify,\n    fetchProfile,\n    isAdmin,\n    isLibrarianOrAdmin,\n    token\n  } = appState;\n  const [file, setFile] = useState(null); // State cho file avatar đã chọn\n  const [isUploading, setIsUploading] = useState(false); // State loading cho việc upload\n\n  // Tự động fetch profile khi component được mount *hoặc* khi token thay đổi (ví dụ: sau khi login)\n  useEffect(() => {\n    if (token) {\n      fetchProfile(token); // Truyền token vào hàm fetchProfile\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [token]); // Chỉ chạy lại khi token thay đổi (bỏ fetchProfile khỏi dependency)\n\n  // Xử lý khi chọn file avatar\n  const handleFileChange = e => {\n    setFile(e.target.files[0]);\n  };\n\n  // Xử lý khi nhấn nút \"Save Avatar\"\n  const handleUpload = async () => {\n    // Kiểm tra xem đã chọn file và đã đăng nhập chưa\n    if (!file || !token) {\n      notify('Vui lòng chọn ảnh và đảm bảo bạn đã đăng nhập.', 'error');\n      return;\n    }\n    setIsUploading(true); // Bắt đầu loading upload\n    const formData = new FormData(); // Dùng FormData để gửi file\n    formData.append('avatar', file);\n    try {\n      // Gọi API upload avatar, **thêm header Authorization thủ công**\n      await axios.post('/profile/avatar', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          // Quan trọng khi gửi file\n          'Authorization': `Bearer ${token}` // Gửi token\n        }\n      });\n      notify('Cập nhật avatar thành công!', 'success');\n      setFile(null); // Xóa file đã chọn khỏi input\n      fetchProfile(token); // Tải lại dữ liệu profile sau khi upload thành công\n    } catch (error) {\n      var _error$response2, _error$response3, _error$response3$data;\n      console.error(\"Lỗi upload avatar:\", ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n      const message = ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.msg) || 'Không thể tải lên avatar.';\n      notify(message, 'error');\n    } finally {\n      setIsUploading(false); // Kết thúc loading upload\n    }\n  };\n\n  // Xử lý khi nhấn nút trả sách\n  const handleReturn = async (borrowingId, title) => {\n    // Kiểm tra đã đăng nhập chưa\n    if (!token) {\n      notify('Yêu cầu xác thực.', 'error');\n      return;\n    }\n    // Xác nhận lại hành động\n    if (!window.confirm(`Bạn chắc chắn muốn trả sách: \"${title}\"?`)) return;\n    try {\n      // Gọi API trả sách, **thêm header Authorization thủ công**\n      // Gửi một object rỗng {} làm data cho POST request nếu không có body\n      await axios.post(`/return/${borrowingId}`, {}, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      notify(`Đã trả sách '${title}' thành công!`, 'success');\n      fetchProfile(token); // Tải lại lịch sử mượn sau khi trả sách\n    } catch (error) {\n      var _error$response4, _error$response5, _error$response5$data;\n      console.error(\"Lỗi trả sách:\", ((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data) || error.message);\n      notify(((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : (_error$response5$data = _error$response5.data) === null || _error$response5$data === void 0 ? void 0 : _error$response5$data.msg) || 'Không thể trả sách.', 'error');\n    }\n  };\n\n  // Nếu chưa có user data (đang load hoặc chưa login), hiển thị thông báo\n  if (!user) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"text-center text-xl mt-12 text-stone-600\",\n    children: \"\\u0110ang t\\u1EA3i h\\u1ED3 s\\u01A1 ho\\u1EB7c vui l\\xF2ng \\u0111\\u0103ng nh\\u1EADp.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 458,\n    columnNumber: 23\n  }, this);\n\n  // Giao diện trang Profile\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container mx-auto px-4 py-8 grid lg:grid-cols-3 gap-8\",\n    children: [/*#__PURE__*/_jsxDEV(Card, {\n      className: \"lg:col-span-1 h-fit\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative w-32 h-32 rounded-full overflow-hidden mb-4 border-4 border-rose-500 shadow-lg\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            // Dùng avatar_url từ user data, fallback về ảnh placeholder màu hồng\n            src: user.avatar_url || 'https://placehold.co/128x128/E879F9/FFFFFF?text=P',\n            alt: \"User Avatar\",\n            className: \"object-cover w-full h-full\"\n            // Xử lý lỗi cơ bản nếu ảnh không load được\n            ,\n            onError: e => {\n              e.target.onerror = null;\n              e.target.src = \"https://placehold.co/128x128/E879F9/FFFFFF?text=Err\";\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 468,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-3xl font-bold text-stone-900\",\n          children: user.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: `text-sm font-semibold mt-1 py-1 px-3 rounded-full ${isAdmin ? 'bg-red-100 text-red-600' : isLibrarianOrAdmin ? 'bg-rose-100 text-rose-600' : 'bg-gray-100 text-stone-600'}`,\n          children: ((_user$role = user.role) === null || _user$role === void 0 ? void 0 : _user$role.toUpperCase()) || 'USER'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-6 w-full space-y-2 text-stone-600\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"flex justify-between items-center border-b pb-1\",\n            children: [\"Email: \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"font-medium text-stone-800 break-all\",\n              children: user.email\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 95\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 485,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"flex justify-between items-center\",\n            children: [\"Ng\\xE0y tham gia: \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"font-medium text-stone-800\",\n              children: user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 486,\n              columnNumber: 89\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs break-words pt-4 text-center text-stone-400\",\n            children: [\"User ID: \", user.id]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 484,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"lg:col-span-2 space-y-8\",\n      children: [/*#__PURE__*/_jsxDEV(Card, {\n        title: \"\\u0110\\u1ED5i Avatar\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            onChange: handleFileChange,\n            accept: \"image/*\",\n            className: \"block w-full text-sm text-stone-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleUpload\n            // Disable nút nếu chưa chọn file, đang upload, hoặc chưa đăng nhập\n            ,\n            disabled: !file || isUploading || !token,\n            className: \"w-full sm:w-auto flex-shrink-0 bg-emerald-600 text-white p-3 rounded-lg font-semibold hover:bg-emerald-700 transition duration-200 shadow-md disabled:bg-emerald-400\",\n            children: isUploading ? 'Đang tải lên...' : 'Lưu Avatar'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 498,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-2 text-sm text-stone-500\",\n          children: \"K\\xEDch th\\u01B0\\u1EDBc t\\u1ED1i \\u0111a: 2MB. \\u0110\\u1ECBnh d\\u1EA1ng: PNG, JPG, JPEG, GIF.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 495,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Card, {\n        title: \"L\\u1ECBch s\\u1EED m\\u01B0\\u1EE3n s\\xE1ch\",\n        children: !user.borrowing_history || user.borrowing_history.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-stone-500\",\n          children: \"B\\u1EA1n ch\\u01B0a m\\u01B0\\u1EE3n cu\\u1ED1n s\\xE1ch n\\xE0o.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4 max-h-96 overflow-y-auto pr-2\",\n          children: user.borrowing_history.map(item => {\n            var _item$status;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-4 border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition duration-200 flex justify-between items-center bg-gray-50\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"font-semibold text-stone-900\",\n                  children: item.book_title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 522,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm text-stone-600\",\n                  children: [\"M\\u01B0\\u1EE3n ng\\xE0y: \", new Date(item.borrow_date).toLocaleDateString()]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 523,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm text-red-500 font-medium\",\n                  children: [\"H\\u1EA1n tr\\u1EA3: \", new Date(item.due_date).toLocaleDateString()]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 524,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 521,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `px-3 py-1 text-xs font-semibold rounded-full ${item.status === 'returned' ? 'bg-emerald-100 text-emerald-600' :\n                  // Kiểm tra cả ngày hết hạn và status để xác định quá hạn\n                  new Date(item.due_date) < new Date() && item.status !== 'returned' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600'}`,\n                  children: ((_item$status = item.status) === null || _item$status === void 0 ? void 0 : _item$status.toUpperCase()) || 'UNKNOWN'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 528,\n                  columnNumber: 41\n                }, this), item.status === 'borrowed' && /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => handleReturn(item.id, item.book_title),\n                  className: \"p-2 bg-rose-500 text-white rounded-full hover:bg-rose-600 transition shadow-md\",\n                  title: \"Tr\\u1EA3 s\\xE1ch\",\n                  children: /*#__PURE__*/_jsxDEV(RotateCcw, {\n                    className: \"w-5 h-5\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 543,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 538,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 527,\n                columnNumber: 37\n              }, this)]\n            }, item.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 519,\n              columnNumber: 33\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 493,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 462,\n    columnNumber: 9\n  }, this);\n};\n\n// --- Component BookModal (ĐÃ DI CHUYỂN RA NGOÀI BookManager) ---\n_s5(ProfilePage, \"wGgdPKLCSvMWjIJcobgkOJRvhwU=\");\n_c9 = ProfilePage;\nconst BookModal = ({\n  appState,\n  currentBook,\n  form,\n  handleInputChange,\n  handleSubmit,\n  handleCloseModal\n}) => {\n  // Lấy trạng thái loading trực tiếp từ appState\n  const {\n    loading\n  } = appState;\n  return (\n    /*#__PURE__*/\n    // Overlay mờ bao phủ toàn màn hình\n    _jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center z-50 p-4 overflow-y-auto\",\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        title: currentBook ? \"Sửa thông tin sách\" : \"Thêm sách mới\",\n        className: \"w-full max-w-lg my-8\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(InputField, {\n            label: \"Ti\\xEAu \\u0111\\u1EC1\",\n            id: \"title\",\n            name: \"title\",\n            value: form.title || '',\n            onChange: handleInputChange,\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 568,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(InputField, {\n            label: \"T\\xE1c gi\\u1EA3\",\n            id: \"author\",\n            name: \"author\",\n            value: form.author || '',\n            onChange: handleInputChange,\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 569,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(InputField, {\n            label: \"ISBN\",\n            id: \"isbn\",\n            name: \"isbn\",\n            value: form.isbn || '',\n            onChange: handleInputChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 570,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-4\",\n            children: [/*#__PURE__*/_jsxDEV(InputField, {\n              label: \"N\\u0103m xu\\u1EA5t b\\u1EA3n\",\n              id: \"published_year\",\n              name: \"published_year\",\n              type: \"number\",\n              value: form.published_year || '',\n              onChange: handleInputChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 572,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(InputField, {\n              label: \"Th\\u1EC3 lo\\u1EA1i\",\n              id: \"genre\",\n              name: \"genre\",\n              value: form.genre || '',\n              onChange: handleInputChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 573,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 571,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(InputField, {\n            label: \"S\\u1ED1 l\\u01B0\\u1EE3ng trong kho\",\n            id: \"stock\",\n            name: \"stock\",\n            type: \"number\",\n            value: form.stock || '',\n            onChange: handleInputChange,\n            required: true,\n            min: \"0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-end space-x-4 mt-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: handleCloseModal,\n              className: \"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition\",\n              children: \"H\\u1EE7y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 580,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              disabled: loading,\n              className: \"flex items-center space-x-2 px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition disabled:bg-rose-400\",\n              children: [/*#__PURE__*/_jsxDEV(Save, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 582,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: loading ? 'Đang lưu...' : 'Lưu sách'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 583,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 581,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 579,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 567,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 566,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 564,\n      columnNumber: 9\n    }, this)\n  );\n};\n\n// --- Component Quản lý Sách (Chỉ Admin/Librarian) ---\n_c0 = BookModal;\nconst BookManager = ({\n  appState,\n  books,\n  fetchBooks\n}) => {\n  _s6();\n  // Lấy token ở đây để dùng cho các API call trong BookManager\n  const {\n    isLibrarianOrAdmin,\n    isAdmin,\n    notify,\n    setLoading,\n    loading,\n    token\n  } = appState;\n  const [isModalOpen, setIsModalOpen] = useState(false); // State đóng/mở modal\n  const [currentBook, setCurrentBook] = useState(null); // State lưu sách đang được sửa (null nếu là thêm mới)\n  // State cho form được giữ cục bộ trong BookManager\n  const [form, setForm] = useState({\n    title: '',\n    author: '',\n    isbn: '',\n    published_year: '',\n    stock: 1,\n    genre: ''\n  });\n\n  // Cập nhật state 'form' cục bộ khi 'currentBook' thay đổi\n  useEffect(() => {\n    if (currentBook) {\n      // Nếu sửa sách, điền thông tin sách vào form\n      setForm({\n        title: currentBook.title || '',\n        author: currentBook.author || '',\n        isbn: currentBook.isbn || '',\n        published_year: currentBook.published_year || '',\n        stock: currentBook.stock || 0,\n        genre: currentBook.genre || ''\n      });\n    } else {\n      // Nếu thêm mới, reset form về giá trị mặc định\n      setForm({\n        title: '',\n        author: '',\n        isbn: '',\n        published_year: '',\n        stock: 1,\n        genre: ''\n      });\n    }\n  }, [currentBook]);\n\n  // Nếu user không phải Librarian hoặc Admin, hiển thị thông báo lỗi\n  if (!isLibrarianOrAdmin) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-red-500 text-xl mt-12\",\n      children: \"Y\\xEAu c\\u1EA7u quy\\u1EC1n truy c\\u1EADp: Ch\\u1EC9 Th\\u1EE7 th\\u01B0 v\\xE0 Admin m\\u1EDBi c\\xF3 th\\u1EC3 truy c\\u1EADp Qu\\u1EA3n l\\xFD s\\xE1ch.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 622,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Hàm mở modal (có thể truyền sách vào để sửa, hoặc không truyền để thêm mới)\n  const handleOpenModal = (book = null) => {\n    setCurrentBook(book); // Cập nhật sách đang sửa/thêm\n    setIsModalOpen(true); // Mở modal\n  };\n\n  // Hàm đóng modal\n  const handleCloseModal = () => {\n    setIsModalOpen(false); // Đóng modal\n    setCurrentBook(null); // Reset sách đang sửa/thêm\n  };\n\n  // Hàm xử lý khi input trong form thay đổi\n  const handleInputChange = e => {\n    const {\n      name,\n      value,\n      type\n    } = e.target;\n    // Cập nhật state 'form' cục bộ\n    setForm(prev => ({\n      ...prev,\n      // Xử lý riêng cho input dạng số\n      [name]: type === 'number' ? parseInt(value) || 0 : value\n    }));\n  };\n\n  // Hàm xử lý khi submit form (Thêm/Sửa sách)\n  const handleSubmit = async e => {\n    e.preventDefault(); // Ngăn form reload trang\n    // Kiểm tra token\n    if (!token) {\n      notify('Yêu cầu xác thực.', 'error');\n      return;\n    }\n    setLoading(true); // Bắt đầu loading\n\n    try {\n      // Chuẩn bị header Authorization\n      const config = {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      };\n      if (currentBook) {\n        // Nếu đang sửa sách (currentBook không null), gọi API PUT\n        await axios.put(`/books/${currentBook.id}`, form, config);\n        notify('Cập nhật sách thành công!', 'success');\n      } else {\n        // Nếu đang thêm mới (currentBook là null), gọi API POST\n        await axios.post('/books', form, config);\n        notify('Thêm sách thành công!', 'success');\n      }\n      fetchBooks(token); // Tải lại danh sách sách sau khi lưu, **truyền token vào**\n      handleCloseModal(); // Đóng modal sau khi thành công\n    } catch (error) {\n      var _error$response6, _error$response7, _error$response7$data;\n      console.error(\"Lỗi lưu sách:\", ((_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data) || error.message);\n      notify(((_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : (_error$response7$data = _error$response7.data) === null || _error$response7$data === void 0 ? void 0 : _error$response7$data.msg) || 'Lỗi lưu dữ liệu sách.', 'error');\n    } finally {\n      setLoading(false); // Kết thúc loading\n    }\n  };\n\n  // Hàm xử lý khi xóa sách\n  const handleDelete = async (bookId, title) => {\n    // Chỉ Admin mới được xóa\n    if (!isAdmin) {\n      notify('Chỉ Admin mới có thể xóa sách.', 'error');\n      return;\n    }\n    // Kiểm tra token\n    if (!token) {\n      notify('Yêu cầu xác thực.', 'error');\n      return;\n    }\n    // Xác nhận lại hành động\n    if (!window.confirm(`Bạn chắc chắn muốn xóa sách: \"${title}\"?`)) return;\n    try {\n      setLoading(true); // Bắt đầu loading\n      // Gọi API DELETE, **thêm header Authorization thủ công**\n      await axios.delete(`/books/${bookId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      notify('Xóa sách thành công!', 'success');\n      fetchBooks(token); // Tải lại danh sách sách sau khi xóa, **truyền token vào**\n    } catch (error) {\n      var _error$response8, _error$response9, _error$response9$data;\n      console.error(\"Lỗi xóa sách:\", ((_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : _error$response8.data) || error.message);\n      notify(((_error$response9 = error.response) === null || _error$response9 === void 0 ? void 0 : (_error$response9$data = _error$response9.data) === null || _error$response9$data === void 0 ? void 0 : _error$response9$data.msg) || 'Lỗi xóa sách.', 'error');\n    } finally {\n      setLoading(false); // Kết thúc loading\n    }\n  };\n\n  // Giao diện BookManager\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [isModalOpen && /*#__PURE__*/_jsxDEV(BookModal, {\n      appState: appState // Truyền toàn bộ appState để modal lấy loading\n      ,\n      currentBook: currentBook,\n      form: form // Truyền state form cục bộ\n      ,\n      handleInputChange: handleInputChange // Truyền hàm xử lý input change\n      ,\n      handleSubmit: handleSubmit // Truyền hàm xử lý submit\n      ,\n      handleCloseModal: handleCloseModal // Truyền hàm đóng modal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 716,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-between items-center mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-3xl font-bold text-stone-800\",\n        children: \"Qu\\u1EA3n l\\xFD s\\xE1ch\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 727,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => handleOpenModal() // Mở modal để thêm mới (không truyền sách)\n        ,\n        className: \"flex items-center space-x-2 px-4 py-2 bg-rose-600 text-white rounded-lg font-semibold hover:bg-rose-700 transition shadow-md\",\n        children: [/*#__PURE__*/_jsxDEV(Plus, {\n          className: \"w-5 h-5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 732,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Th\\xEAm s\\xE1ch m\\u1EDBi\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 728,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 726,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"overflow-x-auto bg-white rounded-xl shadow-2xl\",\n      children: /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"min-w-full divide-y divide-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          className: \"bg-gray-50\",\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"Ti\\xEAu \\u0111\\u1EC1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 742,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"T\\xE1c gi\\u1EA3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 743,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"ISBN\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 744,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"Trong kho\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 745,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"C\\xF3 s\\u1EB5n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 746,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\",\n              children: \"H\\xE0nh \\u0111\\u1ED9ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 747,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 741,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 740,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          className: \"bg-white divide-y divide-gray-200\",\n          children: Array.isArray(books) && books.map(book => /*#__PURE__*/_jsxDEV(\"tr\", {\n            className: \"hover:bg-gray-50\",\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"px-6 py-4 whitespace-nowrap text-sm font-medium text-stone-900\",\n              children: book.title\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 754,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"px-6 py-4 whitespace-nowrap text-sm text-stone-500\",\n              children: book.author\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 755,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"px-6 py-4 whitespace-nowrap text-sm text-stone-500\",\n              children: book.isbn || 'N/A'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 756,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"px-6 py-4 whitespace-nowrap text-sm text-center text-stone-900\",\n              children: book.stock\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 757,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: `px-6 py-4 whitespace-nowrap text-sm text-center font-bold ${book.available_copies === 0 ? 'text-red-500' : 'text-emerald-600'}`,\n              children: book.available_copies\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 758,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex justify-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleOpenModal(book),\n                className: \"text-rose-600 hover:text-rose-900 p-1 rounded-full hover:bg-rose-50 transition\",\n                title: \"S\\u1EEDa s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(Settings, {\n                  className: \"w-5 h-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 764,\n                  columnNumber: 173\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 764,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleDelete(book.id, book.title),\n                disabled: !isAdmin || loading,\n                className: `p-1 rounded-full transition ${isAdmin ? 'text-red-600 hover:text-red-900 hover:bg-red-50' : 'text-stone-400 cursor-not-allowed'} ${loading ? 'opacity-50' : ''}`,\n                title: \"X\\xF3a s\\xE1ch (Ch\\u1EC9 Admin)\",\n                children: /*#__PURE__*/_jsxDEV(Trash2, {\n                  className: \"w-5 h-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 766,\n                  columnNumber: 311\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 766,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 762,\n              columnNumber: 17\n            }, this)]\n          }, book.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 753,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 750,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 739,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 738,\n      columnNumber: 8\n    }, this)]\n  }, void 0, true);\n};\n\n// --- Component Trang Dashboard (Hiển thị danh sách sách cho mọi user) ---\n_s6(BookManager, \"yl+BPKC57tcavW5LBXxQhHQcgJw=\");\n_c1 = BookManager;\nconst DashboardPage = ({\n  appState\n}) => {\n  _s7();\n  // Lấy token ở đây để truyền xuống các hàm con\n  const {\n    isLibrarianOrAdmin,\n    notify,\n    loading,\n    setLoading,\n    token,\n    logout\n  } = appState; // Thêm logout để xử lý lỗi token\n  const [books, setBooks] = useState([]); // State danh sách sách cục bộ\n  const [error, setError] = useState(null); // State lỗi cục bộ\n\n  // Hàm fetchBooks giờ nhận token làm đối số\n  const fetchBooks = useCallback(async authToken => {\n    // Nếu không có token, báo lỗi và không fetch\n    if (!authToken) {\n      console.log(\"fetchBooks: Không có token.\");\n      setError(\"Yêu cầu xác thực để xem sách.\");\n      // notify(\"Yêu cầu xác thực.\", \"error\"); // Có thể bỏ notify ở đây vì đã có error message\n      setBooks([]); // Xóa danh sách sách cũ\n      setLoading(false); // Đảm bảo tắt loading\n      return;\n    }\n    setLoading(true); // Bắt đầu loading\n    setError(null); // Xóa lỗi cũ\n    try {\n      console.log('Đang fetch sách với token...');\n      // Gọi API lấy sách, **thêm header Authorization thủ công**\n      const res = await axios.get('/books', {\n        headers: {\n          'Authorization': `Bearer ${authToken}`\n        }\n      });\n      console.log('Phản hồi books:', res.data);\n      // Cập nhật state sách, đảm bảo là mảng\n      setBooks(Array.isArray(res.data) ? res.data : []);\n    } catch (error) {\n      var _error$response0, _error$response1, _error$response1$data;\n      console.error('Lỗi fetch sách:', ((_error$response0 = error.response) === null || _error$response0 === void 0 ? void 0 : _error$response0.data) || error.message);\n      const errorMessage = ((_error$response1 = error.response) === null || _error$response1 === void 0 ? void 0 : (_error$response1$data = _error$response1.data) === null || _error$response1$data === void 0 ? void 0 : _error$response1$data.msg) || 'Không thể tải danh sách sách.';\n      setError(errorMessage);\n      notify(errorMessage, 'error');\n      // Xử lý lỗi xác thực (token hết hạn/không hợp lệ) -> Tự động logout\n      if (error.response && (error.response.status === 401 || error.response.status === 422)) {\n        logout(); // Gọi hàm logout từ appState\n      }\n    } finally {\n      setLoading(false); // Kết thúc loading\n    }\n    // Phụ thuộc vào các hàm stable (setLoading, notify, logout)\n  }, [setLoading, notify, logout]);\n\n  // useEffect để fetch sách khi component mount *hoặc* khi token thay đổi\n  useEffect(() => {\n    console.log('DashboardPage useEffect: Token =', token);\n    fetchBooks(token); // Truyền token hiện tại vào hàm fetchBooks\n  }, [token, fetchBooks]); // Thêm fetchBooks vào dependency array\n\n  // Hàm xử lý khi mượn sách\n  const handleBorrow = async (bookId, title) => {\n    // Kiểm tra token\n    if (!token) {\n      notify('Vui lòng đăng nhập để mượn sách.', 'error');\n      return;\n    }\n    // Xác nhận hành động\n    if (!window.confirm(`Xác nhận mượn sách: \"${title}\"?`)) return;\n    try {\n      setLoading(true); // Bắt đầu loading\n      // Gọi API mượn sách, **thêm header Authorization thủ công**\n      const res = await axios.post(`/borrow/${bookId}`, {}, {\n        // Gửi object rỗng làm body\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      notify(res.data.msg, 'success'); // Hiển thị thông báo từ server\n      fetchBooks(token); // Tải lại danh sách sách, **truyền token vào**\n    } catch (error) {\n      var _error$response10, _error$response11, _error$response11$dat;\n      console.error(\"Lỗi mượn sách:\", ((_error$response10 = error.response) === null || _error$response10 === void 0 ? void 0 : _error$response10.data) || error.message);\n      notify(((_error$response11 = error.response) === null || _error$response11 === void 0 ? void 0 : (_error$response11$dat = _error$response11.data) === null || _error$response11$dat === void 0 ? void 0 : _error$response11$dat.msg) || 'Không thể mượn sách.', 'error');\n    } finally {\n      setLoading(false); // Kết thúc loading\n    }\n  };\n\n  // --- Render Giao diện ---\n\n  // Hiển thị trạng thái Loading\n  if (loading && books.length === 0) {\n    // Chỉ hiện loading toàn trang nếu chưa có sách nào\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-xl mt-12 text-rose-600\",\n      children: \"\\u0110ang t\\u1EA3i s\\xE1ch...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 858,\n      columnNumber: 14\n    }, this);\n  }\n\n  // Hiển thị trạng thái lỗi (khi chưa đăng nhập)\n  if (error && !token) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center py-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl text-red-600\",\n        children: error || \"Vui lòng đăng nhập để xem sách.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 865,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => appState.setRoute('login') // Lấy setRoute từ appState props\n        ,\n        className: \"mt-4 px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700\",\n        children: \"\\u0110\\u1EBFn trang \\u0111\\u0103ng nh\\u1EADp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 866,\n        columnNumber: 18\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 864,\n      columnNumber: 13\n    }, this);\n  }\n  // Hiển thị trạng thái lỗi (khi đã đăng nhập nhưng fetch lỗi)\n  else if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center py-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl text-red-600\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 879,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => fetchBooks(token) // Thử lại với token hiện tại\n        ,\n        className: \"mt-4 px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700\",\n        children: \"Th\\u1EED t\\u1EA3i l\\u1EA1i s\\xE1ch\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 880,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 878,\n      columnNumber: 13\n    }, this);\n  }\n\n  // Hiển thị nội dung chính\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container mx-auto px-4 py-8\",\n    children: [isLibrarianOrAdmin && /*#__PURE__*/_jsxDEV(BookManager, {\n      appState: appState,\n      books: books,\n      fetchBooks: fetchBooks\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 894,\n      columnNumber: 30\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      className: `text-3xl font-bold text-stone-800 ${isLibrarianOrAdmin ? 'mt-12 border-t pt-8' : 'mt-8'}`,\n      children: \"Danh m\\u1EE5c s\\xE1ch\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 897,\n      columnNumber: 7\n    }, this), !Array.isArray(books) || books.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-stone-600 mt-8\",\n      children: \"Kh\\xF4ng c\\xF3 s\\xE1ch n\\xE0o trong danh m\\u1EE5c.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 904,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",\n      children: books.map(book => /*#__PURE__*/_jsxDEV(Card, {\n        className: \"flex flex-col justify-between hover:shadow-rose-100 transition duration-300 ease-in-out\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-semibold text-rose-700\",\n            children: book.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 912,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-stone-600 italic\",\n            children: [\"b\\u1EDFi \", book.author]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 913,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs mt-2 bg-stone-100 text-stone-700 px-2 py-1 rounded-md w-fit\",\n            children: [\"Th\\u1EC3 lo\\u1EA1i: \", book.genre || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 914,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 911,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4 pt-4 border-t\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm font-medium text-stone-800\",\n            children: [\"C\\xF3 s\\u1EB5n: \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: book.available_copies > 0 ? 'text-emerald-600' : 'text-red-500',\n              children: [book.available_copies, \" / \", book.stock]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 921,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 920,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleBorrow(book.id, book.title)\n            // Disable nút nếu hết sách, đang loading, hoặc chưa đăng nhập\n            ,\n            disabled: book.available_copies === 0 || loading || !token,\n            className: \"mt-3 w-full p-2 bg-rose-600 text-white rounded-lg font-medium hover:bg-rose-700 transition duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed\",\n            children: token ? book.available_copies === 0 ? 'Hết sách' : 'Mượn sách' : 'Đăng nhập để mượn'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 925,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 919,\n          columnNumber: 15\n        }, this)]\n      }, book.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 909,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 906,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 892,\n    columnNumber: 5\n  }, this);\n};\n\n// --- Component Trang Chủ ---\n_s7(DashboardPage, \"cqf7/PmNsnQKUD6ne4yuFiGfEfM=\");\n_c10 = DashboardPage;\nconst HomePage = () => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"container mx-auto px-4 py-16 text-center\",\n  children: /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-5xl font-extrabold text-stone-900 mb-4\",\n      children: \"H\\u1EC7 th\\u1ED1ng Qu\\u1EA3n l\\xFD Th\\u01B0 vi\\u1EC7n N\\xE2ng cao\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 949,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-xl text-stone-600 mb-8\",\n      children: \"Gi\\u1EA3i ph\\xE1p hi\\u1EC7n \\u0111\\u1EA1i c\\u1EE7a b\\u1EA1n \\u0111\\u1EC3 qu\\u1EA3n l\\xFD s\\xE1ch, ng\\u01B0\\u1EDDi d\\xF9ng v\\xE0 l\\u1ECBch s\\u1EED m\\u01B0\\u1EE3n tr\\u1EA3 v\\u1EDBi ki\\u1EC3m so\\xE1t truy c\\u1EADp d\\u1EF1a tr\\xEAn vai tr\\xF2 v\\xE0 tr\\u1EA3i nghi\\u1EC7m ng\\u01B0\\u1EDDi d\\xF9ng \\u0111\\u1EB9p m\\u1EAFt.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 952,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid md:grid-cols-3 gap-6 mt-10\",\n      children: [/*#__PURE__*/_jsxDEV(FeatureCard, {\n        icon: User,\n        title: \"B\\u1EA3o m\\u1EADt theo vai tr\\xF2\",\n        description: \"Ph\\xE2n quy\\u1EC1n truy c\\u1EADp ri\\xEAng cho Admin, Librarian v\\xE0 User th\\xF4ng th\\u01B0\\u1EDDng b\\u1EB1ng JWT.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 958,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(FeatureCard, {\n        icon: BookOpen,\n        title: \"Danh m\\u1EE5c th\\u1EDDi gian th\\u1EF1c\",\n        description: \"Xem t\\xECnh tr\\u1EA1ng s\\xE1ch v\\xE0 qu\\u1EA3n l\\xFD kho v\\u1EDBi c\\u1EADp nh\\u1EADt th\\u1EDDi gian th\\u1EF1c.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 959,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(FeatureCard, {\n        icon: Settings,\n        title: \"H\\u1ED3 s\\u01A1 n\\xE2ng cao\",\n        description: \"H\\u1ED3 s\\u01A1 ng\\u01B0\\u1EDDi d\\xF9ng c\\xE1 nh\\xE2n h\\xF3a v\\u1EDBi t\\u1EA3i l\\xEAn avatar v\\xE0 l\\u1ECBch s\\u1EED m\\u01B0\\u1EE3n.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 960,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 957,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 947,\n    columnNumber: 9\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 946,\n  columnNumber: 5\n}, this);\n\n// Component Feature Card nhỏ\n_c11 = HomePage;\nconst FeatureCard = ({\n  icon: Icon,\n  title,\n  description\n}) => /*#__PURE__*/_jsxDEV(Card, {\n  className: \"flex flex-col items-center text-center p-6 bg-rose-50 border-t-4 border-rose-600 hover:shadow-lg transition duration-300\",\n  children: [/*#__PURE__*/_jsxDEV(Icon, {\n    className: \"w-10 h-10 text-rose-600 mb-3\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 969,\n    columnNumber: 9\n  }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n    className: \"text-xl font-semibold text-stone-800 mb-2\",\n    children: title\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 970,\n    columnNumber: 9\n  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"text-stone-600\",\n    children: description\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 971,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 968,\n  columnNumber: 5\n}, this);\n\n// --- Các Component \"Giữ chỗ\" cho Admin ---\n_c12 = FeatureCard;\nconst UserManagementPage = ({\n  appState\n}) =>\n/*#__PURE__*/\n// Nhận appState để có thể thêm chức năng sau này\n_jsxDEV(\"div\", {\n  className: \"container mx-auto p-8\",\n  children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n    className: \"text-3xl font-bold text-stone-800\",\n    children: \"Qu\\u1EA3n l\\xFD ng\\u01B0\\u1EDDi d\\xF9ng\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 979,\n    columnNumber: 9\n  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"mt-4 text-stone-600\",\n    children: \"(S\\u1EAFp ra m\\u1EAFt: Ch\\u1EE9c n\\u0103ng xem, s\\u1EEDa v\\xE0 qu\\u1EA3n l\\xFD vai tr\\xF2 ng\\u01B0\\u1EDDi d\\xF9ng s\\u1EBD \\u0111\\u01B0\\u1EE3c tri\\u1EC3n khai t\\u1EA1i \\u0111\\xE2y.)\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 980,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 978,\n  columnNumber: 5\n}, this);\n_c13 = UserManagementPage;\nconst SettingsPage = ({\n  appState\n}) =>\n/*#__PURE__*/\n// Nhận appState\n_jsxDEV(\"div\", {\n  className: \"container mx-auto p-8\",\n  children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n    className: \"text-3xl font-bold text-stone-800\",\n    children: \"C\\xE0i \\u0111\\u1EB7t\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 987,\n    columnNumber: 9\n  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"mt-4 text-stone-600\",\n    children: \"(S\\u1EAFp ra m\\u1EAFt: C\\xE1c c\\xE0i \\u0111\\u1EB7t \\u1EE9ng d\\u1EE5ng, nh\\u01B0 gi\\u1EDBi h\\u1EA1n m\\u01B0\\u1EE3n s\\xE1ch, t\\xF9y ch\\u1ECDn th\\xF4ng b\\xE1o, v.v., s\\u1EBD \\u0111\\u01B0\\u1EE3c c\\u1EA5u h\\xECnh t\\u1EA1i \\u0111\\xE2y.)\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 988,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 986,\n  columnNumber: 6\n}, this);\n\n// --- Component App Chính ---\n_c14 = SettingsPage;\nconst App = () => {\n  _s8();\n  // Lấy state và các hàm từ custom hook\n  const appState = useAppState();\n  // Destructure các giá trị cần thiết để dùng trong logic routing và truyền props\n  const {\n    route,\n    token,\n    user,\n    isAdmin\n  } = appState;\n\n  // Logic render nội dung chính dựa trên route và trạng thái đăng nhập\n  const renderContent = useMemo(() => {\n    // ---- Các Route khi CHƯA ĐĂNG NHẬP ----\n    if (!token) {\n      switch (route) {\n        case 'login':\n          return /*#__PURE__*/_jsxDEV(LoginPage, {\n            appState: appState\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1006,\n            columnNumber: 34\n          }, this);\n        case 'register':\n          return /*#__PURE__*/_jsxDEV(RegisterPage, {\n            appState: appState\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1007,\n            columnNumber: 37\n          }, this);\n        // Mọi route khác khi chưa đăng nhập đều về trang chủ\n        case 'home':\n        default:\n          return /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1010,\n            columnNumber: 29\n          }, this);\n      }\n    }\n\n    // ---- Các Route khi ĐÃ ĐĂNG NHẬP ----\n    switch (route) {\n      case 'profile':\n        return /*#__PURE__*/_jsxDEV(ProfilePage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1017,\n          columnNumber: 16\n        }, this);\n\n      // Route 'dashboard' có thể là Admin Dashboard hoặc trang sách tùy vai trò\n      case 'dashboard':\n        return isAdmin ? /*#__PURE__*/_jsxDEV(AdminDashboard, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1022,\n          columnNumber: 16\n        }, this) // Nếu là admin -> Admin Dashboard\n        : /*#__PURE__*/_jsxDEV(DashboardPage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1023,\n          columnNumber: 16\n        }, this);\n      // Mặc định là trang sách cho user thường\n\n      // Route 'books' luôn là trang danh sách/quản lý sách\n      case 'books':\n        return /*#__PURE__*/_jsxDEV(DashboardPage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1027,\n          columnNumber: 18\n        }, this);\n      // DashboardPage tự xử lý quyền Admin/Librarian bên trong\n\n      // ---- Các Route chỉ dành cho Admin ----\n      case 'users':\n        // Nếu là admin -> trang quản lý user, nếu không -> về trang chủ\n        return isAdmin ? /*#__PURE__*/_jsxDEV(UserManagementPage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1032,\n          columnNumber: 28\n        }, this) : /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1032,\n          columnNumber: 73\n        }, this);\n      case 'settings':\n        // Nếu là admin -> trang settings, nếu không -> về trang chủ\n        return isAdmin ? /*#__PURE__*/_jsxDEV(SettingsPage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1035,\n          columnNumber: 28\n        }, this) : /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1035,\n          columnNumber: 67\n        }, this);\n\n      // ---- Route mặc định khi đã đăng nhập ----\n      case 'home':\n        // Cho phép quay về trang chủ ngay cả khi đã đăng nhập\n        return /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1039,\n          columnNumber: 18\n        }, this);\n      default:\n        // Nếu route không khớp các case trên:\n        // Nếu là admin -> về Admin Dashboard\n        // Nếu không phải admin -> về trang sách\n        return isAdmin ? /*#__PURE__*/_jsxDEV(AdminDashboard, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1045,\n          columnNumber: 16\n        }, this) : /*#__PURE__*/_jsxDEV(DashboardPage, {\n          appState: appState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1046,\n          columnNumber: 16\n        }, this);\n    }\n    // Dependencies: Logic render phụ thuộc vào route, token, user, isAdmin và chính appState (để truyền xuống)\n  }, [route, token, isAdmin, appState]);\n\n  // Giao diện App chính\n  return (\n    /*#__PURE__*/\n    // Đổi màu nền sang xám đá\n    _jsxDEV(\"div\", {\n      className: \"min-h-screen bg-stone-100 font-sans\",\n      children: [\" \", /*#__PURE__*/_jsxDEV(Header, {\n        user: user,\n        setRoute: appState.setRoute,\n        logout: appState.logout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1056,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"pb-16\",\n        children: renderContent\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1058,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Notification, {\n        message: appState.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1062,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1054,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n// --- Component Admin Dashboard ---\n_s8(App, \"UN90ThBuv0YP1AdUlTTRcBnR/5o=\", false, function () {\n  return [useAppState];\n});\n_c15 = App;\nconst AdminDashboard = ({\n  appState\n}) => {\n  // Kiểm tra quyền admin trước khi render (dù logic App đã kiểm tra)\n  if (!appState.isAdmin) return /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1071,\n    columnNumber: 33\n  }, this); // Hoặc chuyển hướng về trang không cần quyền\n\n  return (\n    /*#__PURE__*/\n    // Thêm container và padding\n    _jsxDEV(\"div\", {\n      className: \"container mx-auto p-8 space-y-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-3xl font-bold text-stone-800\",\n        children: \"Admin Dashboard\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1076,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-3 gap-6\",\n        children: [/*#__PURE__*/_jsxDEV(DashboardCard, {\n          title: \"Qu\\u1EA3n l\\xFD s\\xE1ch\"\n          // Thêm màu cho icon\n          ,\n          icon: /*#__PURE__*/_jsxDEV(BookOpen, {\n            className: \"h-8 w-8 text-rose-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1083,\n            columnNumber: 17\n          }, this)\n          // onClick sẽ set route thành 'books'\n          ,\n          onClick: () => appState.setRoute('books')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1080,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(DashboardCard, {\n          title: \"Qu\\u1EA3n l\\xFD ng\\u01B0\\u1EDDi d\\xF9ng\",\n          icon: /*#__PURE__*/_jsxDEV(User, {\n            className: \"h-8 w-8 text-rose-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1090,\n            columnNumber: 17\n          }, this),\n          onClick: () => appState.setRoute('users')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1088,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(DashboardCard, {\n          title: \"C\\xE0i \\u0111\\u1EB7t\",\n          icon: /*#__PURE__*/_jsxDEV(Settings, {\n            className: \"h-8 w-8 text-rose-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1096,\n            columnNumber: 17\n          }, this),\n          onClick: () => appState.setRoute('settings')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1094,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1078,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1075,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n// Component Card nhỏ cho Admin Dashboard\n_c16 = AdminDashboard;\nconst DashboardCard = ({\n  title,\n  icon,\n  onClick\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: onClick\n    // Thêm nhiều style hơn cho đẹp: bo góc, shadow, transition, border trái màu hồng\n    ,\n    className: \"p-6 bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-200 text-left w-full border-l-4 border-rose-500 hover:border-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-opacity-50\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center gap-4\",\n      children: [icon, /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-semibold text-stone-900\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1116,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1113,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1108,\n    columnNumber: 5\n  }, this);\n};\n_c17 = DashboardCard;\nexport default App;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1, _c10, _c11, _c12, _c13, _c14, _c15, _c16, _c17;\n$RefreshReg$(_c, \"Notification\");\n$RefreshReg$(_c2, \"Header\");\n$RefreshReg$(_c3, \"NavItem\");\n$RefreshReg$(_c4, \"Card\");\n$RefreshReg$(_c5, \"InputField\");\n$RefreshReg$(_c6, \"AuthForm\");\n$RefreshReg$(_c7, \"RegisterPage\");\n$RefreshReg$(_c8, \"LoginPage\");\n$RefreshReg$(_c9, \"ProfilePage\");\n$RefreshReg$(_c0, \"BookModal\");\n$RefreshReg$(_c1, \"BookManager\");\n$RefreshReg$(_c10, \"DashboardPage\");\n$RefreshReg$(_c11, \"HomePage\");\n$RefreshReg$(_c12, \"FeatureCard\");\n$RefreshReg$(_c13, \"UserManagementPage\");\n$RefreshReg$(_c14, \"SettingsPage\");\n$RefreshReg$(_c15, \"App\");\n$RefreshReg$(_c16, \"AdminDashboard\");\n$RefreshReg$(_c17, \"DashboardCard\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","axios","LogIn","User","BookOpen","Settings","Home","Plus","Trash2","RotateCcw","Save","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE_URL","defaults","baseURL","headers","common","document","getElementById","script","createElement","src","id","head","appendChild","useAppState","_s","user","setUser","savedUser","localStorage","getItem","JSON","parse","e","console","error","removeItem","token","setToken","storedToken","route","setRoute","message","setMessage","text","type","loading","setLoading","setItem","stringify","notify","setTimeout","login","userData","jwtToken","log","role","logout","fetchProfile","authToken","res","get","newUserData","data","prevUser","_error$response","response","status","isAdmin","isLibrarian","isLibrarianOrAdmin","Notification","classes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","Header","onClick","NavItem","icon","label","username","_c2","Icon","_c3","Card","title","_c4","InputField","value","onChange","placeholder","required","name","htmlFor","_c5","AuthForm","state","setState","appState","_s2","isLogin","setError","onSubmit","preventDefault","payload","email","identifier","password","post","Error","err","_err$response","_err$response2","_err$response2$data","msg","target","disabled","_c6","RegisterPage","_s3","form","setForm","_c7","LoginPage","_s4","_c8","ProfilePage","_s5","_user$role","file","setFile","isUploading","setIsUploading","handleFileChange","files","handleUpload","formData","FormData","append","_error$response2","_error$response3","_error$response3$data","handleReturn","borrowingId","window","confirm","_error$response4","_error$response5","_error$response5$data","avatar_url","alt","onError","onerror","toUpperCase","created_at","Date","toLocaleDateString","accept","borrowing_history","length","map","item","_item$status","book_title","borrow_date","due_date","_c9","BookModal","currentBook","handleInputChange","handleSubmit","handleCloseModal","author","isbn","published_year","genre","stock","min","_c0","BookManager","books","fetchBooks","_s6","isModalOpen","setIsModalOpen","setCurrentBook","handleOpenModal","book","prev","parseInt","config","put","_error$response6","_error$response7","_error$response7$data","handleDelete","bookId","delete","_error$response8","_error$response9","_error$response9$data","Array","isArray","available_copies","_c1","DashboardPage","_s7","setBooks","_error$response0","_error$response1","_error$response1$data","errorMessage","handleBorrow","_error$response10","_error$response11","_error$response11$dat","_c10","HomePage","FeatureCard","description","_c11","_c12","UserManagementPage","_c13","SettingsPage","_c14","App","_s8","renderContent","AdminDashboard","_c15","DashboardCard","_c16","_c17","$RefreshReg$"],"sources":["/Users/admin/Downloads/library-ms/frontend/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport axios from 'axios';\nimport { LogIn, User, BookOpen, Settings, Home, Plus, Trash2, RotateCcw, Save } from 'lucide-react';\n\n// Configure Axios to point to the Flask backend\nconst API_BASE_URL = 'http://localhost:5001/api'; // Đảm bảo port này khớp với backend Flask\naxios.defaults.baseURL = API_BASE_URL;\naxios.defaults.headers.common['Content-Type'] = 'application/json';\n\n// --- Global Setup for Tailwind CDN ---\n(function() {\n  if (!document.getElementById('tailwind-cdn')) {\n    const script = document.createElement('script');\n    script.src = 'https://cdn.tailwindcss.com';\n    script.id = 'tailwind-cdn';\n    document.head.appendChild(script);\n  }\n})();\n\n// --- Utility Functions and Hooks ---\n\n// Hook để quản lý trạng thái global của ứng dụng\nconst useAppState = () => {\n    // State cho user, khởi tạo từ localStorage\n    const [user, setUser] = useState(() => {\n        try {\n            const savedUser = localStorage.getItem('user_data');\n            // Xử lý lỗi parse JSON nếu dữ liệu trong localStorage bị hỏng\n            return savedUser && savedUser !== 'undefined' && savedUser !== 'null' ? JSON.parse(savedUser) : null;\n        } catch (e) {\n            console.error(\"Lỗi parse user_data từ localStorage\", e);\n            localStorage.removeItem('user_data'); // Xóa dữ liệu lỗi\n            return null;\n        }\n    });\n    // State cho token, khởi tạo từ localStorage\n    const [token, setToken] = useState(() => {\n      const storedToken = localStorage.getItem('jwt_token');\n      // Đảm bảo token không phải là null hoặc chuỗi \"null\"/\"undefined\"\n      return (storedToken && storedToken !== 'null' && storedToken !== 'undefined') ? storedToken : null;\n    });\n    // State cho route hiện tại\n    const [route, setRoute] = useState('home');\n    // State cho thông báo (notification)\n    const [message, setMessage] = useState({ text: '', type: '' });\n    // State cho trạng thái loading\n    const [loading, setLoading] = useState(false);\n\n    // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n    // Header sẽ được thêm thủ công vào từng request cần xác thực.\n\n    // Lưu user data vào localStorage mỗi khi state 'user' thay đổi\n    useEffect(() => {\n        if (user) {\n            localStorage.setItem('user_data', JSON.stringify(user));\n        } else {\n            // Nếu user là null (ví dụ sau khi logout), xóa khỏi storage\n            localStorage.removeItem('user_data');\n        }\n    }, [user]);\n\n    // Hàm hiển thị thông báo\n    const notify = useCallback((text, type = 'success') => {\n        setMessage({ text, type });\n        setTimeout(() => setMessage({ text: '', type: '' }), 4000);\n    }, []); // setMessage là stable, không cần đưa vào dependency\n\n    // Hàm xử lý đăng nhập\n    const login = useCallback((userData, jwtToken) => {\n        console.log('Login với:', { userData, jwtToken });\n        localStorage.setItem('jwt_token', jwtToken);\n        localStorage.setItem('user_data', JSON.stringify(userData));\n        setToken(jwtToken);\n        setUser(userData);\n        // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n        // Chuyển hướng sau khi đăng nhập (ví dụ: về trang sách nếu là user, về admin dashboard nếu là admin)\n        setRoute(userData.role === 'admin' ? 'dashboard' : 'books');\n    }, []); // setToken, setUser, setRoute là stable\n\n    // Hàm xử lý đăng xuất\n    const logout = useCallback(() => {\n        localStorage.removeItem('jwt_token');\n        localStorage.removeItem('user_data');\n        // --- ĐÃ XÓA: Cài đặt Header global cho Axios ---\n        setToken(null);\n        setUser(null);\n        setRoute('home'); // Chuyển về trang chủ sau khi logout\n    }, []); // setToken, setUser, setRoute là stable\n\n    // Hàm lấy thông tin profile user\n    const fetchProfile = useCallback(async (authToken) => { // Nhận token làm đối số\n        if (!authToken) {\n            console.log(\"fetchProfile: Không có token.\");\n            // Không cần setLoading(true) nếu không có token\n            return;\n        }\n        setLoading(true);\n        try {\n            // Thêm header Authorization thủ công\n            const res = await axios.get('/profile', {\n                headers: { 'Authorization': `Bearer ${authToken}` }\n            });\n            // Giả sử backend trả về trực tiếp data user (không có key 'user' bên ngoài)\n            const newUserData = res.data;\n\n            // Dùng functional update để cập nhật state an toàn\n            setUser(prevUser => ({\n                ...prevUser, // Giữ lại các thuộc tính cũ (nếu có)\n                ...newUserData, // Ghi đè bằng dữ liệu mới từ API\n            }));\n             // Để useEffect tự động lưu vào localStorage khi 'user' thay đổi\n        } catch (error) {\n            console.error('Lỗi fetch profile:', error.response?.data || error.message);\n            // Tự động logout nếu token không hợp lệ (401) hoặc lỗi xác thực (422)\n            if (error.response && (error.response.status === 401 || error.response.status === 422)) {\n                notify('Phiên làm việc không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại.', 'error');\n                logout(); // Gọi hàm logout đã định nghĩa\n            } else {\n                notify('Không thể tải dữ liệu hồ sơ.', 'error');\n            }\n        } finally {\n            setLoading(false);\n        }\n    // Chỉ phụ thuộc vào các hàm stable (logout, notify)\n    }, [logout, notify]);\n\n    // Các biến tiện ích để kiểm tra vai trò user\n    const isAdmin = useMemo(() => user?.role === 'admin', [user]);\n    const isLibrarian = useMemo(() => user?.role === 'librarian', [user]); // Thêm nếu có vai trò librarian\n    const isLibrarianOrAdmin = useMemo(() => isAdmin || isLibrarian, [isAdmin, isLibrarian]);\n\n    // Trả về các state và hàm cần thiết cho các component con\n    return {\n        user,\n        token,\n        route,\n        setRoute,\n        login,\n        logout,\n        message,\n        loading,\n        setLoading,\n        notify,\n        fetchProfile,\n        isAdmin,\n        isLibrarianOrAdmin // Thêm isLibrarianOrAdmin nếu cần\n    };\n};\n\n// --- Các Component Chung ---\n\n// Component hiển thị thông báo\nconst Notification = ({ message }) => {\n  if (!message.text) return null;\n  // Đổi màu thông báo thành công sang xanh ngọc\n  const classes = message.type === 'success'\n    ? 'bg-emerald-500 border-emerald-700'\n    : 'bg-red-500 border-red-700';\n\n  return (\n    <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-semibold shadow-xl transition-all duration-300 ${classes}`}>\n      {message.text}\n    </div>\n  );\n};\n\n// Component Header\nconst Header = ({ user, setRoute, logout }) => {\n  return (\n    // Đổi màu nền header sang xám đá\n    <header className=\"bg-stone-900 shadow-xl text-white sticky top-0 z-40\">\n      <div className=\"container mx-auto px-4 py-4 flex justify-between items-center\">\n        {/* Logo và tên trang */}\n        <div className=\"flex items-center space-x-4 cursor-pointer\" onClick={() => setRoute('home')}>\n          <BookOpen className=\"h-7 w-7 text-rose-400\" />\n          <h1 className=\"text-2xl font-bold text-rose-100\">LMS Pro</h1>\n        </div>\n\n        {/* Navigation */}\n        <nav className=\"flex items-center space-x-4\">\n          <NavItem icon={Home} label=\"Home\" onClick={() => setRoute('home')} />\n\n          {/* Hiển thị khác nhau tùy theo trạng thái đăng nhập */}\n          {user ? (\n            <>\n              {/* Sửa: Nhấn Books sẽ setRoute('books') */}\n              <NavItem icon={BookOpen} label=\"Books\" onClick={() => setRoute('books')} />\n              <NavItem icon={User} label=\"Profile\" onClick={() => setRoute('profile')} />\n              <button\n                onClick={logout}\n                className=\"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n              >\n                <LogIn className=\"h-5 w-5 rotate-180\" />\n                {/* Hiển thị username nếu có */}\n                <span>Logout ({user.username || 'User'})</span>\n              </button>\n            </>\n          ) : (\n            <>\n              <NavItem icon={LogIn} label=\"Login\" onClick={() => setRoute('login')} />\n              <NavItem icon={User} label=\"Register\" onClick={() => setRoute('register')} />\n            </>\n          )}\n        </nav>\n      </div>\n    </header>\n  );\n};\n\n// Component cho một mục trong Navigation\nconst NavItem = ({ icon: Icon, label, onClick }) => (\n  <button\n    onClick={onClick}\n    // Đổi màu chữ sang xám đá, hover nền xám đá\n    className=\"flex items-center space-x-2 px-3 py-2 rounded-lg text-stone-300 hover:bg-stone-800 hover:text-white transition-colors\"\n  >\n    <Icon className=\"h-5 w-5\" />\n    <span>{label}</span>\n  </button>\n);\n\n// Component Card chung\nconst Card = ({ title, children, className = '' }) => (\n  <div className={`bg-white p-6 rounded-xl shadow-2xl transition-all duration-300 ${className}`}>\n    {/* Đổi màu chữ tiêu đề sang xám đá */}\n    {title && <h2 className=\"text-2xl font-bold text-stone-800 mb-4 border-b pb-2\">{title}</h2>}\n    {children}\n  </div>\n);\n\n// Component InputField chung\nconst InputField = ({ label, id, type = 'text', value, onChange, placeholder, required = false, name }) => (\n  <div className=\"mb-4\">\n    {/* Đổi màu chữ label sang xám đá */}\n    <label htmlFor={id} className=\"block text-sm font-medium text-stone-700 mb-1\">\n      {label}\n    </label>\n    <input\n      type={type}\n      id={id}\n      name={name || id}\n      // Đảm bảo value không bao giờ là null/undefined để tránh lỗi controlled/uncontrolled\n      value={value || ''}\n      onChange={onChange}\n      placeholder={placeholder}\n      required={required}\n      // Đổi màu focus sang hồng\n      className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-rose-500 focus:border-rose-500 shadow-sm transition duration-150\"\n    />\n  </div>\n);\n\n// --- Các Component Xác thực ---\n\n// Component Form chung cho Login/Register\nconst AuthForm = ({ title, route, state, setState, appState }) => {\n  const isLogin = route === 'login';\n  // Chỉ lấy các hàm/state cần thiết từ appState\n  const { login, notify, setLoading, loading, setRoute } = appState;\n  const [error, setError] = useState(''); // State lỗi cục bộ cho form\n\n  const onSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true); // Bắt đầu loading\n    setError('');     // Xóa lỗi cũ\n\n    try {\n      // Chuẩn bị payload dựa trên route (login hay register)\n      const payload = isLogin ? {\n        email: state.identifier, // Login dùng email\n        password: state.password\n      } : {\n        username: state.username,\n        email: state.email,\n        password: state.password,\n        role: 'user' // Vai trò mặc định khi đăng ký\n      };\n      // Gọi API tương ứng\n      const response = await axios.post(isLogin ? '/login' : '/register', payload);\n\n      console.log('Phản hồi server:', response.data);\n\n      if (isLogin) {\n        // Xử lý login thành công\n        if (response.data.token && response.data.user) {\n          // Gọi hàm login từ appState để cập nhật state global và localStorage\n          login(response.data.user, response.data.token);\n          notify('Đăng nhập thành công!', 'success');\n          // Không cần setRoute ở đây, hàm login đã xử lý\n        } else {\n          // Ném lỗi nếu response thiếu token hoặc user data\n          throw new Error('Phản hồi không hợp lệ từ server khi đăng nhập');\n        }\n      } else {\n        // Xử lý register thành công\n        notify('Đăng ký thành công! Vui lòng đăng nhập.', 'success');\n        setRoute('login'); // Chuyển hướng sang trang login sau khi đăng ký\n      }\n    } catch (err) { // Đổi tên biến lỗi thành err\n      console.error('Lỗi xác thực:', err.response?.data || err.message);\n      // Lấy thông báo lỗi từ server hoặc lỗi mặc định\n      const message = err.response?.data?.msg || err.message || 'Xác thực thất bại.';\n      setError(message); // Cập nhật state lỗi cục bộ\n      notify(message, 'error'); // Hiển thị thông báo lỗi global\n    } finally {\n      setLoading(false); // Kết thúc loading dù thành công hay thất bại\n    }\n  };\n\n  return (\n    <Card title={title} className=\"max-w-md mx-auto my-12\">\n      <form onSubmit={onSubmit}>\n        {/* Hiển thị lỗi nếu có */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded\">\n            {error}\n          </div>\n        )}\n        {/* Chỉ hiển thị input Username cho form Register */}\n        {!isLogin && (\n          <InputField\n            label=\"Username\"\n            id=\"username\"\n            value={state.username}\n            onChange={(e) => setState({ ...state, username: e.target.value })}\n            required\n          />\n        )}\n        {/* Input Email (luôn là email) */}\n        <InputField\n          label={\"Email\"}\n          id={isLogin ? \"identifier\" : \"email\"} // ID khác nhau cho login/register\n          type=\"email\" // Luôn là type email\n          value={isLogin ? state.identifier : state.email}\n          onChange={(e) => setState({ ...state, [isLogin ? 'identifier' : 'email']: e.target.value })}\n          required\n        />\n        {/* Input Password */}\n        <InputField\n          label=\"Password\"\n          id=\"password\"\n          type=\"password\"\n          value={state.password}\n          onChange={(e) => setState({ ...state, password: e.target.value })}\n          required\n        />\n        {/* Nút Submit */}\n        <button\n          type=\"submit\"\n          disabled={loading} // Disable khi đang loading\n          // Đổi màu nút sang hồng\n          className=\"w-full bg-rose-600 text-white p-3 rounded-lg font-semibold hover:bg-rose-700 transition duration-200 shadow-md disabled:bg-rose-400\"\n        >\n          {loading ? 'Đang xử lý...' : title}\n        </button>\n      </form>\n      {/* Link chuyển đổi giữa Login/Register */}\n      <p className=\"mt-4 text-center text-sm text-stone-500\">\n        {isLogin ? \"Chưa có tài khoản? \" : \"Đã có tài khoản? \"}\n        <button onClick={() => setRoute(isLogin ? 'register' : 'login')} className=\"text-rose-600 hover:text-rose-800 font-medium\">\n          {isLogin ? 'Đăng ký tại đây' : 'Đăng nhập tại đây'}\n        </button>\n      </p>\n    </Card>\n  );\n};\n\n// Component trang Register\nconst RegisterPage = ({ appState }) => {\n  const [form, setForm] = useState({ username: '', email: '', password: '' });\n  return <AuthForm title=\"Tạo tài khoản\" route=\"register\" state={form} setState={setForm} appState={appState} />;\n};\n\n// Component trang Login\nconst LoginPage = ({ appState }) => {\n  const [form, setForm] = useState({ identifier: '', password: '' });\n  return <AuthForm title=\"Đăng nhập\" route=\"login\" state={form} setState={setForm} appState={appState} />;\n};\n\n// --- Component Trang Profile ---\n\nconst ProfilePage = ({ appState }) => {\n    // Lấy token trực tiếp để dùng trong các API call của component này\n    const { user, notify, fetchProfile, isAdmin, isLibrarianOrAdmin, token } = appState;\n    const [file, setFile] = useState(null); // State cho file avatar đã chọn\n    const [isUploading, setIsUploading] = useState(false); // State loading cho việc upload\n\n    // Tự động fetch profile khi component được mount *hoặc* khi token thay đổi (ví dụ: sau khi login)\n    useEffect(() => {\n        if (token) {\n            fetchProfile(token); // Truyền token vào hàm fetchProfile\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [token]); // Chỉ chạy lại khi token thay đổi (bỏ fetchProfile khỏi dependency)\n\n    // Xử lý khi chọn file avatar\n    const handleFileChange = (e) => {\n        setFile(e.target.files[0]);\n    };\n\n    // Xử lý khi nhấn nút \"Save Avatar\"\n    const handleUpload = async () => {\n        // Kiểm tra xem đã chọn file và đã đăng nhập chưa\n        if (!file || !token) {\n            notify('Vui lòng chọn ảnh và đảm bảo bạn đã đăng nhập.', 'error');\n            return;\n        }\n\n        setIsUploading(true); // Bắt đầu loading upload\n        const formData = new FormData(); // Dùng FormData để gửi file\n        formData.append('avatar', file);\n\n        try {\n            // Gọi API upload avatar, **thêm header Authorization thủ công**\n            await axios.post('/profile/avatar', formData, {\n                headers: {\n                    'Content-Type': 'multipart/form-data', // Quan trọng khi gửi file\n                    'Authorization': `Bearer ${token}`      // Gửi token\n                },\n            });\n            notify('Cập nhật avatar thành công!', 'success');\n            setFile(null); // Xóa file đã chọn khỏi input\n            fetchProfile(token); // Tải lại dữ liệu profile sau khi upload thành công\n        } catch (error) {\n            console.error(\"Lỗi upload avatar:\", error.response?.data || error.message);\n            const message = error.response?.data?.msg || 'Không thể tải lên avatar.';\n            notify(message, 'error');\n        } finally {\n            setIsUploading(false); // Kết thúc loading upload\n        }\n    };\n\n    // Xử lý khi nhấn nút trả sách\n    const handleReturn = async (borrowingId, title) => {\n        // Kiểm tra đã đăng nhập chưa\n        if (!token) {\n             notify('Yêu cầu xác thực.', 'error');\n             return;\n        }\n        // Xác nhận lại hành động\n        if (!window.confirm(`Bạn chắc chắn muốn trả sách: \"${title}\"?`)) return;\n\n        try {\n            // Gọi API trả sách, **thêm header Authorization thủ công**\n            // Gửi một object rỗng {} làm data cho POST request nếu không có body\n            await axios.post(`/return/${borrowingId}`, {}, {\n                 headers: { 'Authorization': `Bearer ${token}` }\n            });\n            notify(`Đã trả sách '${title}' thành công!`, 'success');\n            fetchProfile(token); // Tải lại lịch sử mượn sau khi trả sách\n        } catch (error) {\n            console.error(\"Lỗi trả sách:\", error.response?.data || error.message);\n            notify(error.response?.data?.msg || 'Không thể trả sách.', 'error');\n        }\n    };\n\n    // Nếu chưa có user data (đang load hoặc chưa login), hiển thị thông báo\n    if (!user) return <p className=\"text-center text-xl mt-12 text-stone-600\">Đang tải hồ sơ hoặc vui lòng đăng nhập.</p>;\n\n    // Giao diện trang Profile\n    return (\n        <div className=\"container mx-auto px-4 py-8 grid lg:grid-cols-3 gap-8\">\n            {/* Card thông tin User */}\n            <Card className=\"lg:col-span-1 h-fit\">\n                <div className=\"flex flex-col items-center\">\n                    {/* Avatar */}\n                    <div className=\"relative w-32 h-32 rounded-full overflow-hidden mb-4 border-4 border-rose-500 shadow-lg\">\n                        <img\n                            // Dùng avatar_url từ user data, fallback về ảnh placeholder màu hồng\n                            src={user.avatar_url || 'https://placehold.co/128x128/E879F9/FFFFFF?text=P'}\n                            alt=\"User Avatar\"\n                            className=\"object-cover w-full h-full\"\n                            // Xử lý lỗi cơ bản nếu ảnh không load được\n                            onError={(e) => { e.target.onerror = null; e.target.src=\"https://placehold.co/128x128/E879F9/FFFFFF?text=Err\" }}\n                        />\n                    </div>\n                    {/* Username và Role */}\n                    <h3 className=\"text-3xl font-bold text-stone-900\">{user.username}</h3>\n                    <p className={`text-sm font-semibold mt-1 py-1 px-3 rounded-full ${isAdmin ? 'bg-red-100 text-red-600' : isLibrarianOrAdmin ? 'bg-rose-100 text-rose-600' : 'bg-gray-100 text-stone-600'}`}>\n                        {/* Thêm fallback nếu role không có */}\n                        {user.role?.toUpperCase() || 'USER'}\n                    </p>\n                    {/* Thông tin khác */}\n                    <div className=\"mt-6 w-full space-y-2 text-stone-600\">\n                        <p className=\"flex justify-between items-center border-b pb-1\">Email: <span className=\"font-medium text-stone-800 break-all\">{user.email}</span></p>\n                        <p className=\"flex justify-between items-center\">Ngày tham gia: <span className=\"font-medium text-stone-800\">{user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A'}</span></p>\n                        <p className=\"text-xs break-words pt-4 text-center text-stone-400\">User ID: {user.id}</p>\n                    </div>\n                </div>\n            </Card>\n\n            {/* Phần Upload Avatar và Lịch sử mượn */}\n            <div className=\"lg:col-span-2 space-y-8\">\n                {/* Card Upload Avatar */}\n                <Card title=\"Đổi Avatar\">\n                    <div className=\"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 items-center\">\n                        <input type=\"file\" onChange={handleFileChange} accept=\"image/*\" className=\"block w-full text-sm text-stone-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100\" />\n                        <button\n                            onClick={handleUpload}\n                            // Disable nút nếu chưa chọn file, đang upload, hoặc chưa đăng nhập\n                            disabled={!file || isUploading || !token}\n                            className=\"w-full sm:w-auto flex-shrink-0 bg-emerald-600 text-white p-3 rounded-lg font-semibold hover:bg-emerald-700 transition duration-200 shadow-md disabled:bg-emerald-400\"\n                        >\n                            {isUploading ? 'Đang tải lên...' : 'Lưu Avatar'}\n                        </button>\n                    </div>\n                    <p className=\"mt-2 text-sm text-stone-500\">Kích thước tối đa: 2MB. Định dạng: PNG, JPG, JPEG, GIF.</p>\n                </Card>\n\n                {/* Card Lịch sử mượn */}\n                <Card title=\"Lịch sử mượn sách\">\n                    {/* Kiểm tra borrowing_history có tồn tại và có phần tử không */}\n                    {!user.borrowing_history || user.borrowing_history.length === 0 ? (\n                        <p className=\"text-stone-500\">Bạn chưa mượn cuốn sách nào.</p>\n                    ) : (\n                        <div className=\"space-y-4 max-h-96 overflow-y-auto pr-2\">\n                            {/* Map qua lịch sử mượn */}\n                            {user.borrowing_history.map((item) => (\n                                <div key={item.id} className=\"p-4 border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition duration-200 flex justify-between items-center bg-gray-50\">\n                                    {/* Thông tin sách */}\n                                    <div>\n                                        <p className=\"font-semibold text-stone-900\">{item.book_title}</p>\n                                        <p className=\"text-sm text-stone-600\">Mượn ngày: {new Date(item.borrow_date).toLocaleDateString()}</p>\n                                        <p className=\"text-sm text-red-500 font-medium\">Hạn trả: {new Date(item.due_date).toLocaleDateString()}</p>\n                                    </div>\n                                    {/* Trạng thái và nút trả sách */}\n                                    <div className=\"flex items-center space-x-3\">\n                                        <span className={`px-3 py-1 text-xs font-semibold rounded-full ${\n                                            item.status === 'returned' ? 'bg-emerald-100 text-emerald-600' :\n                                            // Kiểm tra cả ngày hết hạn và status để xác định quá hạn\n                                            (new Date(item.due_date) < new Date() && item.status !== 'returned' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600')\n                                        }`}>\n                                            {/* Thêm fallback nếu status không có */}\n                                            {item.status?.toUpperCase() || 'UNKNOWN'}\n                                        </span>\n                                        {/* Chỉ hiển thị nút trả sách nếu status là 'borrowed' */}\n                                        {item.status === 'borrowed' && (\n                                            <button\n                                                onClick={() => handleReturn(item.id, item.book_title)}\n                                                className=\"p-2 bg-rose-500 text-white rounded-full hover:bg-rose-600 transition shadow-md\"\n                                                title=\"Trả sách\"\n                                            >\n                                                <RotateCcw className=\"w-5 h-5\" />\n                                            </button>\n                                        )}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </Card>\n            </div>\n        </div>\n    );\n};\n\n\n// --- Component BookModal (ĐÃ DI CHUYỂN RA NGOÀI BookManager) ---\nconst BookModal = ({ appState, currentBook, form, handleInputChange, handleSubmit, handleCloseModal }) => {\n    // Lấy trạng thái loading trực tiếp từ appState\n    const { loading } = appState;\n    return (\n        // Overlay mờ bao phủ toàn màn hình\n        <div className=\"fixed inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center z-50 p-4 overflow-y-auto\">\n            {/* Card chứa form, thêm margin top/bottom để tránh bị che */}\n            <Card title={currentBook ? \"Sửa thông tin sách\" : \"Thêm sách mới\"} className=\"w-full max-w-lg my-8\">\n                <form onSubmit={handleSubmit}>\n                    <InputField label=\"Tiêu đề\" id=\"title\" name=\"title\" value={form.title || ''} onChange={handleInputChange} required />\n                    <InputField label=\"Tác giả\" id=\"author\" name=\"author\" value={form.author || ''} onChange={handleInputChange} required />\n                    <InputField label=\"ISBN\" id=\"isbn\" name=\"isbn\" value={form.isbn || ''} onChange={handleInputChange} />\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <InputField label=\"Năm xuất bản\" id=\"published_year\" name=\"published_year\" type=\"number\" value={form.published_year || ''} onChange={handleInputChange} />\n                        <InputField label=\"Thể loại\" id=\"genre\" name=\"genre\" value={form.genre || ''} onChange={handleInputChange} />\n                    </div>\n                    {/* Thêm min=\"0\" để số lượng không âm */}\n                    <InputField label=\"Số lượng trong kho\" id=\"stock\" name=\"stock\" type=\"number\" value={form.stock || ''} onChange={handleInputChange} required min=\"0\" />\n\n                    {/* Nút Cancel và Save */}\n                    <div className=\"flex justify-end space-x-4 mt-6\">\n                        <button type=\"button\" onClick={handleCloseModal} className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition\">Hủy</button>\n                        <button type=\"submit\" disabled={loading} className=\"flex items-center space-x-2 px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition disabled:bg-rose-400\">\n                            <Save className=\"w-5 h-5\" />\n                            <span>{loading ? 'Đang lưu...' : 'Lưu sách'}</span>\n                        </button>\n                    </div>\n                </form>\n            </Card>\n        </div>\n    );\n};\n\n\n// --- Component Quản lý Sách (Chỉ Admin/Librarian) ---\nconst BookManager = ({ appState, books, fetchBooks }) => {\n  // Lấy token ở đây để dùng cho các API call trong BookManager\n  const { isLibrarianOrAdmin, isAdmin, notify, setLoading, loading, token } = appState;\n  const [isModalOpen, setIsModalOpen] = useState(false); // State đóng/mở modal\n  const [currentBook, setCurrentBook] = useState(null); // State lưu sách đang được sửa (null nếu là thêm mới)\n  // State cho form được giữ cục bộ trong BookManager\n  const [form, setForm] = useState({ title: '', author: '', isbn: '', published_year: '', stock: 1, genre: '' });\n\n  // Cập nhật state 'form' cục bộ khi 'currentBook' thay đổi\n  useEffect(() => {\n    if (currentBook) {\n      // Nếu sửa sách, điền thông tin sách vào form\n      setForm({\n          title: currentBook.title || '',\n          author: currentBook.author || '',\n          isbn: currentBook.isbn || '',\n          published_year: currentBook.published_year || '',\n          stock: currentBook.stock || 0,\n          genre: currentBook.genre || ''\n      });\n    } else {\n      // Nếu thêm mới, reset form về giá trị mặc định\n      setForm({ title: '', author: '', isbn: '', published_year: '', stock: 1, genre: '' });\n    }\n  }, [currentBook]);\n\n  // Nếu user không phải Librarian hoặc Admin, hiển thị thông báo lỗi\n  if (!isLibrarianOrAdmin) {\n    return <p className=\"text-center text-red-500 text-xl mt-12\">Yêu cầu quyền truy cập: Chỉ Thủ thư và Admin mới có thể truy cập Quản lý sách.</p>;\n  }\n\n  // Hàm mở modal (có thể truyền sách vào để sửa, hoặc không truyền để thêm mới)\n  const handleOpenModal = (book = null) => {\n    setCurrentBook(book); // Cập nhật sách đang sửa/thêm\n    setIsModalOpen(true); // Mở modal\n  };\n\n  // Hàm đóng modal\n  const handleCloseModal = () => {\n    setIsModalOpen(false); // Đóng modal\n    setCurrentBook(null); // Reset sách đang sửa/thêm\n  };\n\n  // Hàm xử lý khi input trong form thay đổi\n  const handleInputChange = (e) => {\n    const { name, value, type } = e.target;\n    // Cập nhật state 'form' cục bộ\n    setForm(prev => ({\n      ...prev,\n      // Xử lý riêng cho input dạng số\n      [name]: type === 'number' ? (parseInt(value) || 0) : value\n    }));\n  };\n\n  // Hàm xử lý khi submit form (Thêm/Sửa sách)\n  const handleSubmit = async (e) => {\n    e.preventDefault(); // Ngăn form reload trang\n    // Kiểm tra token\n    if (!token) {\n        notify('Yêu cầu xác thực.', 'error');\n        return;\n    }\n    setLoading(true); // Bắt đầu loading\n\n    try {\n        // Chuẩn bị header Authorization\n        const config = { headers: { 'Authorization': `Bearer ${token}` } };\n        if (currentBook) {\n            // Nếu đang sửa sách (currentBook không null), gọi API PUT\n            await axios.put(`/books/${currentBook.id}`, form, config);\n            notify('Cập nhật sách thành công!', 'success');\n        } else {\n            // Nếu đang thêm mới (currentBook là null), gọi API POST\n            await axios.post('/books', form, config);\n            notify('Thêm sách thành công!', 'success');\n        }\n        fetchBooks(token); // Tải lại danh sách sách sau khi lưu, **truyền token vào**\n        handleCloseModal(); // Đóng modal sau khi thành công\n    } catch (error) {\n        console.error(\"Lỗi lưu sách:\", error.response?.data || error.message);\n        notify(error.response?.data?.msg || 'Lỗi lưu dữ liệu sách.', 'error');\n    } finally {\n        setLoading(false); // Kết thúc loading\n    }\n  };\n\n  // Hàm xử lý khi xóa sách\n  const handleDelete = async (bookId, title) => {\n    // Chỉ Admin mới được xóa\n    if (!isAdmin) {\n      notify('Chỉ Admin mới có thể xóa sách.', 'error');\n      return;\n    }\n    // Kiểm tra token\n    if (!token) {\n        notify('Yêu cầu xác thực.', 'error');\n        return;\n    }\n    // Xác nhận lại hành động\n    if (!window.confirm(`Bạn chắc chắn muốn xóa sách: \"${title}\"?`)) return;\n\n    try {\n        setLoading(true); // Bắt đầu loading\n        // Gọi API DELETE, **thêm header Authorization thủ công**\n        await axios.delete(`/books/${bookId}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        notify('Xóa sách thành công!', 'success');\n        fetchBooks(token); // Tải lại danh sách sách sau khi xóa, **truyền token vào**\n    } catch (error) {\n        console.error(\"Lỗi xóa sách:\", error.response?.data || error.message);\n        notify(error.response?.data?.msg || 'Lỗi xóa sách.', 'error');\n    } finally {\n        setLoading(false); // Kết thúc loading\n    }\n  };\n\n  // Giao diện BookManager\n  return (\n    <>\n      {/* Render BookModal nếu isModalOpen là true, truyền các props cần thiết */}\n      {isModalOpen && (\n          <BookModal\n              appState={appState} // Truyền toàn bộ appState để modal lấy loading\n              currentBook={currentBook}\n              form={form} // Truyền state form cục bộ\n              handleInputChange={handleInputChange} // Truyền hàm xử lý input change\n              handleSubmit={handleSubmit}       // Truyền hàm xử lý submit\n              handleCloseModal={handleCloseModal}     // Truyền hàm đóng modal\n          />\n      )}\n      {/* Tiêu đề và nút Add New Book */}\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-3xl font-bold text-stone-800\">Quản lý sách</h2>\n        <button\n          onClick={() => handleOpenModal()} // Mở modal để thêm mới (không truyền sách)\n          className=\"flex items-center space-x-2 px-4 py-2 bg-rose-600 text-white rounded-lg font-semibold hover:bg-rose-700 transition shadow-md\"\n        >\n          <Plus className=\"w-5 h-5\" />\n          <span>Thêm sách mới</span>\n        </button>\n      </div>\n\n      {/* Bảng hiển thị danh sách sách */}\n       <div className=\"overflow-x-auto bg-white rounded-xl shadow-2xl\">\n        <table className=\"min-w-full divide-y divide-gray-200\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\">Tiêu đề</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\">Tác giả</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider\">ISBN</th>\n              <th className=\"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\">Trong kho</th>\n              <th className=\"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\">Có sẵn</th>\n              <th className=\"px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider\">Hành động</th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n             {/* Đảm bảo 'books' là một mảng trước khi map */}\n            {Array.isArray(books) && books.map((book) => (\n              <tr key={book.id} className=\"hover:bg-gray-50\">\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-stone-900\">{book.title}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-stone-500\">{book.author}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-stone-500\">{book.isbn || 'N/A'}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-center text-stone-900\">{book.stock}</td>\n                <td className={`px-6 py-4 whitespace-nowrap text-sm text-center font-bold ${book.available_copies === 0 ? 'text-red-500' : 'text-emerald-600'}`}>\n                  {book.available_copies}\n                </td>\n                {/* Nút Sửa và Xóa */}\n                <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex justify-center space-x-3\">\n                  {/* Nút Sửa: Mở modal và truyền sách hiện tại vào */}\n                  <button onClick={() => handleOpenModal(book)} className=\"text-rose-600 hover:text-rose-900 p-1 rounded-full hover:bg-rose-50 transition\" title=\"Sửa sách\"><Settings className=\"w-5 h-5\" /></button>\n                  {/* Nút Xóa: Chỉ enable cho Admin và không bị disable khi đang loading */}\n                  <button onClick={() => handleDelete(book.id, book.title)} disabled={!isAdmin || loading} className={`p-1 rounded-full transition ${isAdmin ? 'text-red-600 hover:text-red-900 hover:bg-red-50' : 'text-stone-400 cursor-not-allowed'} ${loading ? 'opacity-50' : ''}`} title=\"Xóa sách (Chỉ Admin)\"><Trash2 className=\"w-5 h-5\" /></button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </>\n  );\n};\n\n\n// --- Component Trang Dashboard (Hiển thị danh sách sách cho mọi user) ---\nconst DashboardPage = ({ appState }) => {\n  // Lấy token ở đây để truyền xuống các hàm con\n  const { isLibrarianOrAdmin, notify, loading, setLoading, token, logout } = appState; // Thêm logout để xử lý lỗi token\n  const [books, setBooks] = useState([]); // State danh sách sách cục bộ\n  const [error, setError] = useState(null); // State lỗi cục bộ\n\n  // Hàm fetchBooks giờ nhận token làm đối số\n  const fetchBooks = useCallback(async (authToken) => {\n    // Nếu không có token, báo lỗi và không fetch\n    if (!authToken) {\n        console.log(\"fetchBooks: Không có token.\");\n        setError(\"Yêu cầu xác thực để xem sách.\");\n        // notify(\"Yêu cầu xác thực.\", \"error\"); // Có thể bỏ notify ở đây vì đã có error message\n        setBooks([]); // Xóa danh sách sách cũ\n        setLoading(false); // Đảm bảo tắt loading\n        return;\n    }\n    setLoading(true); // Bắt đầu loading\n    setError(null);   // Xóa lỗi cũ\n    try {\n      console.log('Đang fetch sách với token...');\n      // Gọi API lấy sách, **thêm header Authorization thủ công**\n      const res = await axios.get('/books', {\n          headers: { 'Authorization': `Bearer ${authToken}` }\n      });\n      console.log('Phản hồi books:', res.data);\n      // Cập nhật state sách, đảm bảo là mảng\n      setBooks(Array.isArray(res.data) ? res.data : []);\n    } catch (error) {\n      console.error('Lỗi fetch sách:', error.response?.data || error.message);\n      const errorMessage = error.response?.data?.msg || 'Không thể tải danh sách sách.';\n      setError(errorMessage);\n      notify(errorMessage, 'error');\n      // Xử lý lỗi xác thực (token hết hạn/không hợp lệ) -> Tự động logout\n      if (error.response && (error.response.status === 401 || error.response.status === 422)) {\n          logout(); // Gọi hàm logout từ appState\n      }\n    } finally {\n      setLoading(false); // Kết thúc loading\n    }\n  // Phụ thuộc vào các hàm stable (setLoading, notify, logout)\n  }, [setLoading, notify, logout]);\n\n  // useEffect để fetch sách khi component mount *hoặc* khi token thay đổi\n  useEffect(() => {\n    console.log('DashboardPage useEffect: Token =', token);\n    fetchBooks(token); // Truyền token hiện tại vào hàm fetchBooks\n  }, [token, fetchBooks]); // Thêm fetchBooks vào dependency array\n\n  // Hàm xử lý khi mượn sách\n  const handleBorrow = async (bookId, title) => {\n    // Kiểm tra token\n    if (!token) {\n        notify('Vui lòng đăng nhập để mượn sách.', 'error');\n        return;\n    }\n    // Xác nhận hành động\n    if (!window.confirm(`Xác nhận mượn sách: \"${title}\"?`)) return;\n\n    try {\n        setLoading(true); // Bắt đầu loading\n        // Gọi API mượn sách, **thêm header Authorization thủ công**\n        const res = await axios.post(`/borrow/${bookId}`, {}, { // Gửi object rỗng làm body\n             headers: { 'Authorization': `Bearer ${token}` }\n        });\n        notify(res.data.msg, 'success'); // Hiển thị thông báo từ server\n        fetchBooks(token); // Tải lại danh sách sách, **truyền token vào**\n    } catch (error) {\n        console.error(\"Lỗi mượn sách:\", error.response?.data || error.message);\n        notify(error.response?.data?.msg || 'Không thể mượn sách.', 'error');\n    } finally {\n        setLoading(false); // Kết thúc loading\n    }\n  };\n\n    // --- Render Giao diện ---\n\n    // Hiển thị trạng thái Loading\n    if (loading && books.length === 0) { // Chỉ hiện loading toàn trang nếu chưa có sách nào\n      return <p className=\"text-center text-xl mt-12 text-rose-600\">Đang tải sách...</p>;\n    }\n\n    // Hiển thị trạng thái lỗi (khi chưa đăng nhập)\n    if (error && !token) {\n        return (\n            <div className=\"text-center py-8\">\n                <p className=\"text-xl text-red-600\">{error || \"Vui lòng đăng nhập để xem sách.\"}</p>\n                 <button\n                    onClick={() => appState.setRoute('login')} // Lấy setRoute từ appState props\n                    className=\"mt-4 px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700\"\n                >\n                    Đến trang đăng nhập\n                </button>\n            </div>\n        );\n    }\n    // Hiển thị trạng thái lỗi (khi đã đăng nhập nhưng fetch lỗi)\n    else if (error) {\n         return (\n            <div className=\"text-center py-8\">\n                <p className=\"text-xl text-red-600\">{error}</p>\n                <button\n                    onClick={() => fetchBooks(token)} // Thử lại với token hiện tại\n                    className=\"mt-4 px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700\"\n                >\n                    Thử tải lại sách\n                </button>\n            </div>\n        );\n    }\n\n  // Hiển thị nội dung chính\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      {/* Hiển thị component BookManager nếu user là Librarian hoặc Admin */}\n      {isLibrarianOrAdmin && <BookManager appState={appState} books={books} fetchBooks={fetchBooks} />}\n\n      {/* Tiêu đề Catalog */}\n      <h2 className={`text-3xl font-bold text-stone-800 ${isLibrarianOrAdmin ? 'mt-12 border-t pt-8' : 'mt-8'}`}>\n        Danh mục sách\n      </h2>\n\n      {/* Danh sách sách dạng grid */}\n      {/* Đảm bảo books là mảng và không rỗng */}\n      {!Array.isArray(books) || books.length === 0 ? (\n        <p className=\"text-center text-stone-600 mt-8\">Không có sách nào trong danh mục.</p>\n      ) : (\n        <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n          {/* Map qua danh sách sách */}\n          {books.map((book) => (\n            <Card key={book.id} className=\"flex flex-col justify-between hover:shadow-rose-100 transition duration-300 ease-in-out\">\n              {/* Phần thông tin sách */}\n              <div>\n                <h3 className=\"text-xl font-semibold text-rose-700\">{book.title}</h3>\n                <p className=\"text-sm text-stone-600 italic\">bởi {book.author}</p>\n                <p className=\"text-xs mt-2 bg-stone-100 text-stone-700 px-2 py-1 rounded-md w-fit\">\n                  Thể loại: {book.genre || 'N/A'}\n                </p>\n              </div>\n              {/* Phần số lượng và nút Mượn */}\n              <div className=\"mt-4 pt-4 border-t\">\n                <p className=\"text-sm font-medium text-stone-800\">\n                  Có sẵn: <span className={book.available_copies > 0 ? 'text-emerald-600' : 'text-red-500'}>\n                    {book.available_copies} / {book.stock}\n                  </span>\n                </p>\n                <button\n                  onClick={() => handleBorrow(book.id, book.title)}\n                  // Disable nút nếu hết sách, đang loading, hoặc chưa đăng nhập\n                  disabled={book.available_copies === 0 || loading || !token}\n                  className=\"mt-3 w-full p-2 bg-rose-600 text-white rounded-lg font-medium hover:bg-rose-700 transition duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                >\n                  {/* Text nút thay đổi tùy trạng thái */}\n                  {token ? (book.available_copies === 0 ? 'Hết sách' : 'Mượn sách') : 'Đăng nhập để mượn'}\n                </button>\n              </div>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\n\n// --- Component Trang Chủ ---\nconst HomePage = () => (\n    <div className=\"container mx-auto px-4 py-16 text-center\">\n        <div className=\"max-w-3xl mx-auto\">\n            {/* Tiêu đề và mô tả */}\n            <h1 className=\"text-5xl font-extrabold text-stone-900 mb-4\">\n                Hệ thống Quản lý Thư viện Nâng cao\n            </h1>\n            <p className=\"text-xl text-stone-600 mb-8\">\n                Giải pháp hiện đại của bạn để quản lý sách, người dùng và lịch sử mượn trả với kiểm soát truy cập dựa trên vai trò và trải nghiệm người dùng đẹp mắt.\n            </p>\n\n            {/* Các Feature Card */}\n            <div className=\"grid md:grid-cols-3 gap-6 mt-10\">\n                <FeatureCard icon={User} title=\"Bảo mật theo vai trò\" description=\"Phân quyền truy cập riêng cho Admin, Librarian và User thông thường bằng JWT.\" />\n                <FeatureCard icon={BookOpen} title=\"Danh mục thời gian thực\" description=\"Xem tình trạng sách và quản lý kho với cập nhật thời gian thực.\" />\n                <FeatureCard icon={Settings} title=\"Hồ sơ nâng cao\" description=\"Hồ sơ người dùng cá nhân hóa với tải lên avatar và lịch sử mượn.\" />\n            </div>\n        </div>\n    </div>\n);\n\n// Component Feature Card nhỏ\nconst FeatureCard = ({ icon: Icon, title, description }) => (\n    <Card className=\"flex flex-col items-center text-center p-6 bg-rose-50 border-t-4 border-rose-600 hover:shadow-lg transition duration-300\">\n        <Icon className=\"w-10 h-10 text-rose-600 mb-3\" />\n        <h3 className=\"text-xl font-semibold text-stone-800 mb-2\">{title}</h3>\n        <p className=\"text-stone-600\">{description}</p>\n    </Card>\n);\n\n\n// --- Các Component \"Giữ chỗ\" cho Admin ---\nconst UserManagementPage = ({ appState }) => ( // Nhận appState để có thể thêm chức năng sau này\n    <div className=\"container mx-auto p-8\">\n        <h1 className=\"text-3xl font-bold text-stone-800\">Quản lý người dùng</h1>\n        <p className=\"mt-4 text-stone-600\">(Sắp ra mắt: Chức năng xem, sửa và quản lý vai trò người dùng sẽ được triển khai tại đây.)</p>\n        {/* TODO: Thêm giao diện quản lý người dùng */}\n    </div>\n);\n\nconst SettingsPage = ({ appState }) => ( // Nhận appState\n     <div className=\"container mx-auto p-8\">\n        <h1 className=\"text-3xl font-bold text-stone-800\">Cài đặt</h1>\n        <p className=\"mt-4 text-stone-600\">(Sắp ra mắt: Các cài đặt ứng dụng, như giới hạn mượn sách, tùy chọn thông báo, v.v., sẽ được cấu hình tại đây.)</p>\n        {/* TODO: Thêm giao diện cài đặt */}\n    </div>\n);\n\n\n// --- Component App Chính ---\nconst App = () => {\n  // Lấy state và các hàm từ custom hook\n  const appState = useAppState();\n  // Destructure các giá trị cần thiết để dùng trong logic routing và truyền props\n  const { route, token, user, isAdmin } = appState;\n\n  // Logic render nội dung chính dựa trên route và trạng thái đăng nhập\n  const renderContent = useMemo(() => {\n    // ---- Các Route khi CHƯA ĐĂNG NHẬP ----\n    if (!token) {\n        switch (route) {\n            case 'login': return <LoginPage appState={appState} />;\n            case 'register': return <RegisterPage appState={appState} />;\n            // Mọi route khác khi chưa đăng nhập đều về trang chủ\n            case 'home':\n            default: return <HomePage />;\n        }\n    }\n\n    // ---- Các Route khi ĐÃ ĐĂNG NHẬP ----\n    switch (route) {\n      case 'profile':\n        return <ProfilePage appState={appState} />;\n\n      // Route 'dashboard' có thể là Admin Dashboard hoặc trang sách tùy vai trò\n      case 'dashboard':\n         return isAdmin\n             ? <AdminDashboard appState={appState} /> // Nếu là admin -> Admin Dashboard\n             : <DashboardPage appState={appState} />; // Mặc định là trang sách cho user thường\n\n      // Route 'books' luôn là trang danh sách/quản lý sách\n      case 'books':\n          return <DashboardPage appState={appState} />; // DashboardPage tự xử lý quyền Admin/Librarian bên trong\n\n      // ---- Các Route chỉ dành cho Admin ----\n      case 'users':\n          // Nếu là admin -> trang quản lý user, nếu không -> về trang chủ\n          return isAdmin ? <UserManagementPage appState={appState} /> : <HomePage />;\n      case 'settings':\n          // Nếu là admin -> trang settings, nếu không -> về trang chủ\n          return isAdmin ? <SettingsPage appState={appState} /> : <HomePage />;\n\n      // ---- Route mặc định khi đã đăng nhập ----\n      case 'home': // Cho phép quay về trang chủ ngay cả khi đã đăng nhập\n          return <HomePage />;\n      default:\n         // Nếu route không khớp các case trên:\n         // Nếu là admin -> về Admin Dashboard\n         // Nếu không phải admin -> về trang sách\n         return isAdmin\n             ? <AdminDashboard appState={appState} />\n             : <DashboardPage appState={appState} />;\n    }\n  // Dependencies: Logic render phụ thuộc vào route, token, user, isAdmin và chính appState (để truyền xuống)\n  }, [route, token, isAdmin, appState]);\n\n  // Giao diện App chính\n  return (\n    // Đổi màu nền sang xám đá\n    <div className=\"min-h-screen bg-stone-100 font-sans\"> {/* Thay bg-gray-50 thành bg-stone-100 cho sáng hơn */}\n      {/* Header luôn hiển thị */}\n      <Header user={user} setRoute={appState.setRoute} logout={appState.logout} />\n      {/* Nội dung chính được render dựa trên logic trong renderContent */}\n      <main className=\"pb-16\">\n        {renderContent}\n      </main>\n      {/* Thông báo luôn hiển thị (nếu có message) */}\n      <Notification message={appState.message} />\n    </div>\n  );\n};\n\n\n// --- Component Admin Dashboard ---\nconst AdminDashboard = ({ appState }) => {\n  // Kiểm tra quyền admin trước khi render (dù logic App đã kiểm tra)\n  if (!appState.isAdmin) return <HomePage />; // Hoặc chuyển hướng về trang không cần quyền\n\n  return (\n    // Thêm container và padding\n    <div className=\"container mx-auto p-8 space-y-6\">\n      <h1 className=\"text-3xl font-bold text-stone-800\">Admin Dashboard</h1>\n      {/* Grid chứa các card chức năng */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        {/* Card Manage Books */}\n        <DashboardCard\n          title=\"Quản lý sách\"\n          // Thêm màu cho icon\n          icon={<BookOpen className=\"h-8 w-8 text-rose-600\" />}\n          // onClick sẽ set route thành 'books'\n          onClick={() => appState.setRoute('books')}\n        />\n        {/* Card Manage Users */}\n        <DashboardCard\n          title=\"Quản lý người dùng\"\n          icon={<User className=\"h-8 w-8 text-rose-600\" />}\n          onClick={() => appState.setRoute('users')}\n        />\n        {/* Card Settings */}\n        <DashboardCard\n          title=\"Cài đặt\"\n          icon={<Settings className=\"h-8 w-8 text-rose-600\" />}\n          onClick={() => appState.setRoute('settings')}\n        />\n      </div>\n       {/* Có thể thêm các widget hoặc thông tin khác chỉ dành cho admin ở đây */}\n    </div>\n  );\n};\n\n// Component Card nhỏ cho Admin Dashboard\nconst DashboardCard = ({ title, icon, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      // Thêm nhiều style hơn cho đẹp: bo góc, shadow, transition, border trái màu hồng\n      className=\"p-6 bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-200 text-left w-full border-l-4 border-rose-500 hover:border-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-opacity-50\"\n    >\n      <div className=\"flex items-center gap-4\">\n        {icon}\n        {/* Đổi font thành semibold */}\n        <h3 className=\"text-lg font-semibold text-stone-900\">{title}</h3>\n      </div>\n    </button>\n  );\n};\n\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}